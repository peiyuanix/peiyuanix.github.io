<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.lpypl.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1},"gitalk":{"order":-2}},"activeClass":"disqus"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="刘沛源的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Yuan&#39;s blog">
<meta property="og:url" content="https://blog.lpypl.top/page/2/index.html">
<meta property="og:site_name" content="Yuan&#39;s blog">
<meta property="og:description" content="刘沛源的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Liu Peiyuan">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.lpypl.top/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Yuan's blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-190455776-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-190455776-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Yuan's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Yuan's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">刘沛源的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-rss">

    <a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lpypl.top/2021/07/30/Linux%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87-bridge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
      <meta itemprop="name" content="Liu Peiyuan">
      <meta itemprop="description" content="刘沛源的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/30/Linux%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87-bridge/" class="post-title-link" itemprop="url">Linux虚拟网络设备-birdge</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-30 13:00:00" itemprop="dateCreated datePublished" datetime="2021-07-30T13:00:00+08:00">2021-07-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-22 00:27:23" itemprop="dateModified" datetime="2025-09-22T00:27:23+08:00">2025-09-22</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/07/30/Linux%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87-bridge/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/07/30/Linux虚拟网络设备-bridge/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="网络桥接"><a href="#网络桥接" class="headerlink" title="网络桥接"></a>网络桥接</h2><p>网桥是一种网络设备，它能够从多个通信网络创建一个单一的聚合网络，此功能被称为网络桥接。网络桥接不同于路由，路由允许多个独立网络互相通信，但各个网络仍然保持独立，而桥接是将多个独立网络连接成一个单一网络。</p>
<p>网桥工作于OSI模型的数据链路层，它基于以太网地址（而不是IP地址）转发数据包。交换机是一种常见的网络桥接设备，家用路由器内部一般也带有集成交换机。</p>
<h2 id="Linux-bridge"><a href="#Linux-bridge" class="headerlink" title="Linux bridge"></a>Linux bridge</h2><p>Linux bridge实现了<strong>802.1d</strong>标准的一个子集，Linux网桥比纯粹的硬件网桥更加强大，它不仅可以转发数据包，还可以进行过滤和流量调整等功能。</p>
<p>下面介绍一下Linux bridge的配置工具，然后利用树莓派上进行一个简单的桥接实验。</p>
<h2 id="ip-和-bridge"><a href="#ip-和-bridge" class="headerlink" title="ip 和 bridge"></a>ip 和 bridge</h2><p>iproute2程序包包含的 <code>ip</code> 和 <code>bridge</code> 命令可用于管理网桥。</p>
<h3 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h3><h4 id="ip命令"><a href="#ip命令" class="headerlink" title="ip命令"></a>ip命令</h4><ul>
<li><p>创建bridge设备 <code>br0</code></p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip link add name br0 type bridge</span><br></pre></td></tr></table></figure>
</li>
<li><p>将interface <code>eth0</code>添加到bridge <code>br0</code></p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip link set eth0 master br0</span><br></pre></td></tr></table></figure>
<p>  上面是以物理网卡 <code>eth0</code> 为例，但网桥中的设备不仅限于物理设备，<code>tun/tap/veth/vlan/macvlan/macvtap/ipvlan/ipvtap</code> 等各种虚拟设备均可添加到 bridge。  </p>
<p>  <code>eth0</code> 原本一端连接着外界物理网络，另一端连接着网络协议栈。一旦它接入了 <code>br0</code>，由外部传入 <code>eth0</code> 的数据包将被直接传递到 <code>br0</code>，而不再是网络协议栈。这样一来，为 <code>eth0</code> 配置IP就失去了意义，因为 <code>eth0</code> 另一端连接的只是一个虚拟网桥 <code>br0</code>，这是一个2层设备，它工作于数据链路层，仅基于MAC地址进行数据包转发，形象地说，也就是 <code>eth0</code> 现在只是相当于 <code>br0</code> 的一个 Port，把 <code>br0</code> 比作以太交换机，那么 <code>eth0</code> 就是 <code>br0</code> 的一个网口。</p>
<p>  原本的网络结构：<br>  <code>eth0</code> 连接着网络协议栈与外界网络</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------------------------------+</span><br><span class="line">|                                                 |</span><br><span class="line">|   +----------------------------------------+    |</span><br><span class="line">|   |         Network Protocol Stack         |    |</span><br><span class="line">|   +----------------------------------------+    |</span><br><span class="line">|            ↑                     ↑              |</span><br><span class="line">|............|.....................|..............|</span><br><span class="line">|            |                     |              |</span><br><span class="line">|            ↓                     ↓              |</span><br><span class="line">|     +--------------+         +--------+         |</span><br><span class="line">|     | 192.168.2.10 |         |        |         |</span><br><span class="line">|     +--------------+         |   br0  |         |</span><br><span class="line">|     |     eth0     |         |        |         |</span><br><span class="line">|     +--------------+         +--------+         |</span><br><span class="line">|            ↑                                    |</span><br><span class="line">|            |                                    |</span><br><span class="line">+------------|------------------------------------+</span><br><span class="line">             ↓                                     </span><br><span class="line">     Physical Network                              </span><br></pre></td></tr></table></figure>
<p>  之后的网络结构：<br>  <code>eth0</code> 收到的外界数据包不再发给网络协议栈，而是虚拟2层设备 <code>br0</code></p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------------------------------+</span><br><span class="line">|                                                 |</span><br><span class="line">|   +----------------------------------------+    |</span><br><span class="line">|   |         Network Protocol Stack         |    |</span><br><span class="line">|   +----------------------------------------+    |</span><br><span class="line">|            |                     ↑              |</span><br><span class="line">|............|.....................|..............|</span><br><span class="line">|            |                     |              |</span><br><span class="line">|            ↓                     ↓              |</span><br><span class="line">|     +--------------+         +---------+        |</span><br><span class="line">|     | 192.168.2.10 |         |         |        |</span><br><span class="line">|     +--------------+         |   br0   |        |</span><br><span class="line">|     |     eth0     |&lt;-------&gt;|         |        |</span><br><span class="line">|     +--------------+         +---------+        |</span><br><span class="line">|            ↑                                    |</span><br><span class="line">|            |                                    |</span><br><span class="line">+------------|------------------------------------+</span><br><span class="line">             ↓                                     </span><br><span class="line">     Physical Network                              </span><br></pre></td></tr></table></figure>
</li>
<li><p>开启bridge br0</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set link br0 up</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="bridge命令"><a href="#bridge命令" class="headerlink" title="bridge命令"></a>bridge命令</h4><ul>
<li><code>bridge link</code>：展示桥接到网桥的interface（相当于交换机的网口）  </li>
<li><code>bridge fdb</code>：展示网桥的转发表</li>
<li><code>bridge vlan</code>：展示网桥的VLAN配置信息</li>
</ul>
<p>由上面的分析，可以得知Linux虚拟网桥设备 <code>bridge</code> 可以将多个 interface 连接为一个网络，并且虚拟网桥设备有自己的MAC转发表，也可以在虚拟网桥中配置VLAN。  </p>
<h2 id="利用树莓派验证brdige的二层交换功能"><a href="#利用树莓派验证brdige的二层交换功能" class="headerlink" title="利用树莓派验证brdige的二层交换功能"></a>利用树莓派验证brdige的二层交换功能</h2><h3 id="实验设备"><a href="#实验设备" class="headerlink" title="实验设备"></a>实验设备</h3><ul>
<li>树莓派3b+：包含一个以太网卡 <code>eth0</code>，一个无线网卡 <code>wlan0</code>  </li>
<li>PC：有一个以太网口</li>
<li>手机：可以连接WiFI</li>
</ul>
<h3 id="实验思路"><a href="#实验思路" class="headerlink" title="实验思路"></a>实验思路</h3><ul>
<li>在树莓派上创建一个 bridge，称为 <code>br0</code>  </li>
<li>PC通过网线接入 <code>eth0</code>，WiFi设备接入基于 <code>wlan0</code> 构建的无线局域网  </li>
<li>将 <code>eth0</code> 和 <code>wlan0</code> 添加到 <code>br0</code>，利用<code>br0</code> 将无线局域网和PC桥接在一起  </li>
</ul>
<p>这样一来，网络结构如下图所示（略去了Network Protocol Stack -&gt; eth0 的单向连接）：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">            +-------------------------------------------------+</span><br><span class="line">            |   +----------------------------------------+    |</span><br><span class="line">            |   |         Network Protocol Stack         |    |</span><br><span class="line">            |   +----------------------------------------+    |</span><br><span class="line">            |                        ↑                        |</span><br><span class="line">            |........................|........................|</span><br><span class="line">            |                        ↓                        |</span><br><span class="line">            |       +----------------------------------+      |</span><br><span class="line">            |       |               br0                |      |</span><br><span class="line">            |       +----------------------------------+      |</span><br><span class="line">            |            ↑                       ↑            |</span><br><span class="line">            |            |                       |            |</span><br><span class="line">            |            ↓                       ↓            |</span><br><span class="line">            |     +--------------+       +--------------+     |</span><br><span class="line">            |     |     eth0     |       |     wlan0    |&lt;---------&gt; WiFi_Device</span><br><span class="line">            |     +--------------+       +--------------+     |</span><br><span class="line">            |            ↑                  ↑        ↑        |</span><br><span class="line">            +------------|------------------|--------|--------+</span><br><span class="line">                         ↓                  ↓        ↓         </span><br><span class="line">                        PC            WiFi_Device  WiFi_Device  </span><br><span class="line">```                                    </span><br><span class="line"></span><br><span class="line">根据其原理，只要合理地配置PC和无线设备的IP地址，它们理应可以借助虚拟网桥 `br0` 互相访问。</span><br><span class="line"></span><br><span class="line">### 关键步骤</span><br><span class="line"></span><br><span class="line">#### 树莓派配置AP</span><br><span class="line"></span><br><span class="line">借助 `hostapd` 实现，大致步骤为：  </span><br><span class="line"></span><br><span class="line">1. 安装 `hostapd`  </span><br><span class="line">    ```shell</span><br><span class="line">    sudo apt install hostapd</span><br></pre></td></tr></table></figure></p>
<ol>
<li>配置 <code>hostapd</code>，创建 <code>/etc/hostapd/hostapd.conf</code>   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">interface=wlan0</span><br><span class="line">bridge=br0</span><br><span class="line">hw_mode=g</span><br><span class="line">channel=7</span><br><span class="line">wmm_enabled=0</span><br><span class="line">macaddr_acl=0</span><br><span class="line">auth_algs=1</span><br><span class="line">ignore_broadcast_ssid=0</span><br><span class="line">wpa=2</span><br><span class="line">wpa_key_mgmt=WPA-PSK</span><br><span class="line">wpa_pairwise=TKIP</span><br><span class="line">rsn_pairwise=CCMP</span><br><span class="line">ssid=RaspberryPi</span><br><span class="line">wpa_passphrase=password</span><br></pre></td></tr></table></figure></li>
<li>关闭 <code>dhcpcd</code>，启用 <code>hostapd</code> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo disable dhcpcd</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">References: /usr/share/doc/hostapd/README.Debian</span></span><br><span class="line">sudo systemctl unmask hostapd</span><br><span class="line">sudo systemctl enable hostapd</span><br></pre></td></tr></table></figure></li>
<li>连接热点 <code>RaspberryPi</code><br> 配置好之后重启树莓派应该就能看到热点 <code>RaspberryPi</code> 了，由于树莓派没有开启dhcpd，WiFI设备需要配置使用Static IP，比如 <code>192.168.31.100/24</code>  </li>
</ol>
<h4 id="桥接"><a href="#桥接" class="headerlink" title="桥接"></a>桥接</h4><ol>
<li>创建虚拟网桥 <code>br0</code>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip link add name br0 type bridge</span><br></pre></td></tr></table></figure></li>
<li>添加设备 <code>eth0</code>，<code>wlan0</code> 至 <code>br0</code>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ip link set dev eth0 master br0</span><br><span class="line">sudo ip link set dev wlan0 master br0</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="连接网络"><a href="#连接网络" class="headerlink" title="连接网络"></a>连接网络</h4><p>由于树莓派没有开启dhcpd，需要为各个连接到WiFI的设备配置静态IP，当然经网线连接的PC也需要配置，各个设备的IP需要处于同一网段才能互相访问，比如 <code>192.168.31.0/24</code>  </p>
<h3 id="故障排除"><a href="#故障排除" class="headerlink" title="故障排除"></a>故障排除</h3><ol>
<li><p>PC和无线设备都配置好了却无法互相连接<br> 关掉Windows防火墙再试试，稍等一会儿再试试<br> 在<a target="_blank" rel="noopener" href="https://wiki.linuxfoundation.org/networking/bridge">Networking: bridge - Linux Foundation DokuWiki</a>中有这样一句话：</p>
<blockquote>
<p>The bridge will take a short amount of time when a device is added to learn the Ethernet addresses on the segment before starting to forward.</p>
</blockquote>
</li>
<li><p>暂时没有2</p>
</li>
</ol>
<h2 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h2><p>PC ping通了连接WiFI的手机，成功借助虚拟网桥连通了<code>eth0</code>和<code>wlan0</code>无线局域网。</p>
<h3 id="树莓派配置信息"><a href="#树莓派配置信息" class="headerlink" title="树莓派配置信息"></a>树莓派配置信息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">Script started on 2021-07-30 20:07:21+08:00 [TERM=&quot;linux&quot; TTY=&quot;/dev/tty1&quot; COLUMNS=&quot;240&quot; LINES=&quot;67&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pi@rasp:~/projects/bridge $ ip -d addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity 0 minmtu 0 maxmtu 0 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master br0 state UP group default qlen 1000</span><br><span class="line">    link/ether b8:27:eb:98:76:96 brd ff:ff:ff:ff:ff:ff promiscuity 1 minmtu 68 maxmtu 9000</span><br><span class="line">    bridge_slave state forwarding priority 32 cost 4 hairpin off guard off root_block off fastleave off learning on flood on port_id 0x8002 port_no 0x2 designated_port 32770 designated_cost 0 designated_bridge 8000.b8:27:eb:98:76:96 designated_root 8000.b8:27:eb:98:76:96 hold_timer    0.00 message_age_timer    0.00 forward_delay_timer    0.00 topology_change_ack 0 config_pending 0 proxy_arp off proxy_arp_wifi off mcast_router 1 mcast_fast_leave off mcast_flood on neigh_suppress off group_fwd_mask 0 group_fwd_mask_str 0x0 vlan_tunnel off isolated off numtxqueues 1 numrxqueues 1 gso_max_size 8824 gso_max_segs 65535</span><br><span class="line">3: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master br0 state UP group default qlen 1000</span><br><span class="line">    link/ether b8:27:eb:cd:23:c3 brd ff:ff:ff:ff:ff:ff promiscuity 1 minmtu 68 maxmtu 1500</span><br><span class="line">    bridge_slave state forwarding priority 32 cost 100 hairpin off guard off root_block off fastleave off learning on flood on port_id 0x8001 port_no 0x1 designated_port 32769 designated_cost 0 designated_bridge 8000.b8:27:eb:98:76:96 designated_root 8000.b8:27:eb:98:76:96 hold_timer    0.00 message_age_timer    0.00 forward_delay_timer    0.00 topology_change_ack 0 config_pending 0 proxy_arp off proxy_arp_wifi off mcast_router 1 mcast_fast_leave off mcast_flood on neigh_suppress off group_fwd_mask 0 group_fwd_mask_str 0x0 vlan_tunnel off isolated off numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535</span><br><span class="line">5: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether b8:27:eb:98:76:96 brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 68 maxmtu 65535</span><br><span class="line">    bridge forward_delay 1500 hello_time 200 max_age 2000 ageing_time 30000 stp_state 0 priority 32768 vlan_filtering 0 bridge_id 8000.b8:27:eb:98:76:96 designated_root 8000.b8:27:eb:98:76:96 root_port 0 root_path_cost 0 topology_change 0 topology_change_detected 0 hello_timer    0.00 tcn_timer    0.00 topology_change_timer    0.00 gc_timer  220.78 group_fwd_mask 0 group_address 01:80:c2:00:00:00 mcast_snooping 1 mcast_router 1 mcast_query_use_ifaddr 0 mcast_querier 0 mcast_hash_elasticity 16 mcast_hash_max 4096 mcast_last_member_count 2 mcast_startup_query_count 2 mcast_last_member_interval 100 mcast_membership_interval 26000 mcast_querier_interval 25500 mcast_query_interval 12500 mcast_query_response_interval 1000 mcast_startup_query_interval 3125 mcast_stats_enabled 0 mcast_igmp_version 2 mcast_mld_version 1 nf_call_iptables 0 nf_call_ip6tables 0 nf_call_arptables 0 numtxqueues 1 numrxqueues 1 gso_max_size 8824 gso_max_segs 65535</span><br><span class="line">    inet6 fe80::ba27:ebff:fecd:23c3/64 scope link</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pi@rasp:~/projects/bridge $ bridge -d link</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 master br0 state forwarding priority 32 cost 4</span><br><span class="line">    hairpin off guard off root_block off fastleave off learning on flood on mcast_flood on neigh_suppress off vlan_tunnel off isolated off</span><br><span class="line">3: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 master br0 state forwarding priority 32 cost 100</span><br><span class="line">    hairpin off guard off root_block off fastleave off learning on flood on mcast_flood on neigh_suppress off vlan_tunnel off isolated off</span><br><span class="line">5: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 master br0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pi@rasp:~/projects/bridge $ bridge fdb</span><br><span class="line">f4:30:b9:ad:56:eb dev eth0 master br0</span><br><span class="line">b8:27:eb:98:76:96 dev eth0 master br0 permanent</span><br><span class="line">01:00:5e:00:00:01 dev eth0 self permanent</span><br><span class="line">33:33:00:00:00:01 dev eth0 self permanent</span><br><span class="line">e0:cc:f8:ce:27:a9 dev wlan0 master br0</span><br><span class="line">b8:27:eb:cd:23:c3 dev wlan0 master br0 permanent</span><br><span class="line">01:00:5e:00:00:01 dev wlan0 self permanent</span><br><span class="line">33:33:00:00:00:01 dev wlan0 self permanent</span><br><span class="line">33:33:00:00:00:01 dev br0 self permanent</span><br><span class="line">01:00:5e:00:00:6a dev br0 self permanent</span><br><span class="line">33:33:00:00:00:6a dev br0 self permanent</span><br><span class="line">01:00:5e:00:00:01 dev br0 self permanent</span><br><span class="line">33:33:ff:cd:23:c3 dev br0 self permanent</span><br><span class="line">33:33:00:00:00:fb dev br0 self permanent</span><br><span class="line">pi@rasp:~/projects/bridge $ bridge -d fdb</span><br><span class="line">f4:30:b9:ad:56:eb dev eth0 master br0</span><br><span class="line">b8:27:eb:98:76:96 dev eth0 master br0 permanent</span><br><span class="line">01:00:5e:00:00:01 dev eth0 self permanent</span><br><span class="line">33:33:00:00:00:01 dev eth0 self permanent</span><br><span class="line">e0:cc:f8:ce:27:a9 dev wlan0 master br0</span><br><span class="line">b8:27:eb:cd:23:c3 dev wlan0 master br0 permanent</span><br><span class="line">01:00:5e:00:00:01 dev wlan0 self permanent</span><br><span class="line">33:33:00:00:00:01 dev wlan0 self permanent</span><br><span class="line">33:33:00:00:00:01 dev br0 self permanent</span><br><span class="line">01:00:5e:00:00:6a dev br0 self permanent</span><br><span class="line">33:33:00:00:00:6a dev br0 self permanent</span><br><span class="line">01:00:5e:00:00:01 dev br0 self permanent</span><br><span class="line">33:33:ff:cd:23:c3 dev br0 self permanent</span><br><span class="line">33:33:00:00:00:fb dev br0 self permanent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pi@rasp:~/projects/bridge $ bridge -d vlan</span><br><span class="line">port    vlan ids</span><br><span class="line">eth0</span><br><span class="line">wlan0</span><br><span class="line">br0</span><br><span class="line">pi@rasp:~/projects/bridge $ exit</span><br><span class="line"></span><br><span class="line">Script done on 2021-07-30 20:08:17+08:00 [COMMAND_EXIT_CODE=&quot;0&quot;]</span><br></pre></td></tr></table></figure>
<h3 id="设备IP配置"><a href="#设备IP配置" class="headerlink" title="设备IP配置"></a>设备IP配置</h3><ul>
<li>PC：<code>192.168.100.100</code>  </li>
<li>手机：<code>192.168.100.102</code>  </li>
</ul>
<h3 id="tcpdump部分抓包结果"><a href="#tcpdump部分抓包结果" class="headerlink" title="tcpdump部分抓包结果"></a>tcpdump部分抓包结果</h3><p>抓包命令：<code>sudo tcpdump -i br0</code>  </p>
<p>可以看到两台设备之间的 ICMP echo request 和 ICMP echo reply，至于为什么没有互相询问ARP的消息，大概是因为在我截取消息的时候他们已经知道了对方的MAC。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">19:56:53.340646 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:56:53.577869 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 279, length 64</span><br><span class="line">19:56:53.578378 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 279, length 64</span><br><span class="line">19:56:54.105795 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:56:54.580512 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 280, length 64</span><br><span class="line">19:56:54.580882 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 280, length 64</span><br><span class="line">19:56:54.875747 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:56:55.582730 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 281, length 64</span><br><span class="line">19:56:55.583236 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 281, length 64</span><br><span class="line">19:56:55.629983 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:56:56.584221 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 282, length 64</span><br><span class="line">19:56:56.584775 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 282, length 64</span><br><span class="line">19:56:57.079863 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:56:57.585969 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 283, length 64</span><br><span class="line">19:56:57.586473 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 283, length 64</span><br><span class="line">19:56:57.851101 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:56:58.587740 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 284, length 64</span><br><span class="line">19:56:58.588376 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 284, length 64</span><br><span class="line">19:56:58.606484 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:56:59.589851 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 285, length 64</span><br><span class="line">19:56:59.590206 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 285, length 64</span><br><span class="line">19:56:59.639003 IP 192.168.17.102.62171 &gt; 239.255.255.250.1900: UDP, length 174</span><br><span class="line">19:57:00.591333 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 286, length 64</span><br><span class="line">19:57:00.592043 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 286, length 64</span><br><span class="line">19:57:00.642907 IP 192.168.17.102.62171 &gt; 239.255.255.250.1900: UDP, length 174</span><br><span class="line">19:57:01.593566 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 287, length 64</span><br><span class="line">19:57:01.593930 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 287, length 64</span><br><span class="line">19:57:01.645152 IP 192.168.17.102.62171 &gt; 239.255.255.250.1900: UDP, length 174</span><br><span class="line">19:57:01.729974 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:57:02.491623 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:57:02.582445 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 288, length 64</span><br><span class="line">19:57:02.582814 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 288, length 64</span><br><span class="line">19:57:02.646148 IP 192.168.17.102.62171 &gt; 239.255.255.250.1900: UDP, length 174</span><br><span class="line">19:57:03.258025 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:57:03.595961 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 289, length 64</span><br><span class="line">19:57:03.596639 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 289, length 64</span><br><span class="line">19:57:04.121192 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:57:04.599132 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 290, length 64</span><br><span class="line">19:57:04.599516 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 290, length 64</span><br><span class="line">19:57:04.881646 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:57:05.592449 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 291, length 64</span><br><span class="line">19:57:05.593202 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 291, length 64</span><br><span class="line">19:57:05.630129 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br><span class="line">19:57:06.601837 IP 192.168.17.100 &gt; 192.168.17.102: ICMP echo request, id 2945, seq 292, length 64</span><br><span class="line">19:57:06.602326 IP 192.168.17.102 &gt; 192.168.17.100: ICMP echo reply, id 2945, seq 292, length 64</span><br><span class="line">19:57:06.735715 ARP, Request who-has 192.168.17.1 tell 192.168.17.100, length 28</span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bridging_(networking">Bridging (networking) - Wikipedia</a>)  </li>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Network_bridge">Network bridge - ArchWiki</a>  </li>
<li><a target="_blank" rel="noopener" href="https://wiki.linuxfoundation.org/networking/bridge">Networking: bridge - Linux Foundation DokuWiki</a>  </li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000009491002">Linux虚拟网络设备之bridge(桥) - SegmentFault 思否</a>  </li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lpypl.top/2021/07/29/Win10%E7%A6%81%E7%94%A8Ctrl+Space%E4%B8%AD%E8%8B%B1%E6%96%87%E5%88%87%E6%8D%A2%E5%BF%AB%E6%8D%B7%E9%94%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
      <meta itemprop="name" content="Liu Peiyuan">
      <meta itemprop="description" content="刘沛源的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/29/Win10%E7%A6%81%E7%94%A8Ctrl+Space%E4%B8%AD%E8%8B%B1%E6%96%87%E5%88%87%E6%8D%A2%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="post-title-link" itemprop="url">Win10禁用Ctrl+Space中英文切换快捷键</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-29 14:00:00" itemprop="dateCreated datePublished" datetime="2021-07-29T14:00:00+08:00">2021-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-22 00:27:23" itemprop="dateModified" datetime="2025-09-22T00:27:23+08:00">2025-09-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tutorial/" itemprop="url" rel="index"><span itemprop="name">Tutorial</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/07/29/Win10%E7%A6%81%E7%94%A8Ctrl+Space%E4%B8%AD%E8%8B%B1%E6%96%87%E5%88%87%E6%8D%A2%E5%BF%AB%E6%8D%B7%E9%94%AE/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/07/29/Win10禁用Ctrl+Space中英文切换快捷键/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>623</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>十几年的老BUG了，Win7时代的修改注册表的方法也失效了。<br>Win7时代的方案在这里：<a target="_blank" rel="noopener" href="https://superuser.com/questions/327479/ctrl-space-always-toggles-chinese-ime-windows-7">CTRL-Space always toggles Chinese IME (Windows 7)</a>  </p>
<p>需要注意的是：</p>
<ul>
<li><code>HKEY_CURRENT_USER/Control Panel/Input Method/Hot Keys</code> 保存的是当前用户的快捷键配置</li>
<li><code>HKEY_USERS\.DEFAULT\Control Panel\Input Method\Hot Keys</code> 保存的是系统默认的快捷键配置</li>
</ul>
<p>当年的方案修改的是用户快捷键配置，现已失效，现在需要修改系统默认的快捷键配置。</p>
<h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><ol>
<li>打开注册表编辑器  </li>
<li>打开 <code>HKEY_USERS\.DEFAULT\Control Panel\Input Method\Hot Keys</code>  </li>
<li>需要修改两项，<code>00000070</code> 是繁体中文快捷键配置，<code>00000010</code> 是简体中文快捷键配置   </li>
<li>分别打开上面所说的两项，修改下面两项数据<ul>
<li><code>Key Modifiers</code> 代表 Alt/Ctrl/Shift等修饰键，默认配置是 <code>Ctrl (02c00000)</code>，把它的第一个字节由 <code>02</code> 改为 <code>00</code>  </li>
<li><code>Virtual Key</code> 代表与修饰键配合使用的辅助键，默认配置为 <code>Space (20000000)</code>，把它的第一个字节由 <code>20</code> 改为 <code>FF</code>  </li>
</ul>
</li>
<li>然后重启系统即可，也许注销再登录就行  </li>
<li>我是只改系统默认配置然后重启，<code>Ctrl+Space</code>就无效了，如果只改系统默认配置无效的话，可以再把用户配置也按相同方法改掉，再不行的话就等微软修复BUG吧~~~   </li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lpypl.top/2021/07/24/VMWare-UbuntuServer2004%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
      <meta itemprop="name" content="Liu Peiyuan">
      <meta itemprop="description" content="刘沛源的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/24/VMWare-UbuntuServer2004%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">VMWare-UbuntuServer2004网络配置记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-24 14:00:00" itemprop="dateCreated datePublished" datetime="2021-07-24T14:00:00+08:00">2021-07-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-22 00:27:23" itemprop="dateModified" datetime="2025-09-22T00:27:23+08:00">2025-09-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tutorial/" itemprop="url" rel="index"><span itemprop="name">Tutorial</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/07/24/VMWare-UbuntuServer2004%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%E8%AE%B0%E5%BD%95/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/07/24/VMWare-UbuntuServer2004网络配置记录/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="达成的目标"><a href="#达成的目标" class="headerlink" title="达成的目标"></a>达成的目标</h2><p>在Ubuntu Server 20.04 虚拟机当中添加了两块虚拟网卡。一块VMWare虚拟网卡以桥接模式使用电脑的网线接口直接与树莓派通信，可拥有独立于物理网卡的Mac地址和IP地址，同时在树莓派上测试了Macvlan虚拟网卡，Macvlan虚拟网卡有多种工作模式，其中桥接模式可使虚拟网络接口借助物理接口与外界直接通信。另一块VMWare虚拟网卡配置为NAT模式，借助主机网络访问互联网。</p>
<h2 id="主机配置"><a href="#主机配置" class="headerlink" title="主机配置"></a>主机配置</h2><h3 id="桥接网络配置"><a href="#桥接网络配置" class="headerlink" title="桥接网络配置"></a>桥接网络配置</h3><p>VMWare默认的桥接网络会自动选择用于桥接的实体网卡，如果需要指定通过网线接口而非无线网卡桥接，就需要专门进行配置。在虚拟网络编辑器当中为默认桥接网络指定网卡即可。<br><img src="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/20210725011524.png" alt=""></p>
<h3 id="NAT网络配置"><a href="#NAT网络配置" class="headerlink" title="NAT网络配置"></a>NAT网络配置</h3><p>NAT网卡无需特别配置，默认的配置已经开启了DHCP，但是需要注意的是网关可能不是 <code>192.168.227.1</code>（以我的IP为例说明） ，我原本在虚拟机中配置了静态地址，结果无法访问互联网，也无法ping通 <code>192.168.227.1</code>，后来改成了 DHCP 模式，发现虚拟机自动配置的网关是 <code>192.168.227.2</code>，而Windows中可以看到 <code>VMware Virtual Ethernet Adapter for VMnet8</code> 的IP是 <code>192.168.227.1</code>，值得关注的还有 <code>IPv4 WINS 服务器: 192.168.227.2</code>，通过查看虚拟机上自动经DHCP配置好的信息，发现虚拟机的网关和DNS服务器恰好都是 <code>192.168.227.2</code>，因此如果想要配置静态IP，需要注意网关和DNS服务器的配置。我所采用的方法是在开启DHCP Client的同时再额外配置一个自定义的IP地址，这样既可以在局域网通过自定义IP地址访问虚拟机，也可以使虚拟机自动配置网关和DNS服务器。</p>
<p>虚拟机ping不通主机是因为Windows防护墙，关掉就能ping通了，不过即使能ping通，也无法将 <code>192.168.227.1</code> 配置为网关来访问互联网，原因上面说了。</p>
<h4 id="VMware-Virtual-Ethernet-Adapter-for-VMnet8-网络属性"><a href="#VMware-Virtual-Ethernet-Adapter-for-VMnet8-网络属性" class="headerlink" title="VMware Virtual Ethernet Adapter for VMnet8 网络属性"></a>VMware Virtual Ethernet Adapter for VMnet8 网络属性</h4><p><img src="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/20210725012623.png" alt=""></p>
<h4 id="虚拟机当中由DHCP-Client配置的-DNS-以及网关"><a href="#虚拟机当中由DHCP-Client配置的-DNS-以及网关" class="headerlink" title="虚拟机当中由DHCP Client配置的 DNS 以及网关"></a>虚拟机当中由DHCP Client配置的 DNS 以及网关</h4><p><img src="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/20210725014830.png" alt=""></p>
<p><img src="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/20210725014854.png" alt=""></p>
<h4 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h4><p>后来发现VMWare网络编辑器里面是能看到网关信息的，确实是 <code>192.168.227.2</code>，如果想要手动配置，就按这个信息配置。</p>
<p><img src="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/20210725124934.png" alt=""></p>
<h2 id="虚拟机配置"><a href="#虚拟机配置" class="headerlink" title="虚拟机配置"></a>虚拟机配置</h2><h3 id="Ubuntu-Server-20-04-的网络配置方法"><a href="#Ubuntu-Server-20-04-的网络配置方法" class="headerlink" title="Ubuntu Server 20.04 的网络配置方法"></a>Ubuntu Server 20.04 的网络配置方法</h3><p>Ubuntu Server 20.04 使用 <code>netplan</code> 进行网络管理（总是旧的还不熟悉就换了，，）,还默认启用 <code>systemd-resolve</code> 进行域名解析，所以网络配置文件不再是 <code>/etc/network/interfaces</code>，DNS配置文件也不再是 <code>/etc/resolv.conf</code>。</p>
<p>网络配置文件是 <code>/etc/netplan/*</code>，我就直接修改了安装时生成的文件 <code>/etc/netplan/00-installer-config.yaml</code>，修改完毕之后需要执行 <code>sudo netplan try</code> 命令检测配置并按Enter应用配置。</p>
<p>DNS配置文件我没有仔细查，看<code>systemd-resolve</code>文档即可，不过<code>/etc/resolv.conf</code>的开头是这样的，最好不要乱改。顺便说一下，查看DNS服务器的命令是 <code>resolvectl status</code>。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># This file is managed by man:systemd-resolved(8). Do not edit.</span><br></pre></td></tr></table></figure></p>
<h3 id="我的配置文件"><a href="#我的配置文件" class="headerlink" title="我的配置文件"></a>我的配置文件</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># This is the network config written by &#x27;subiquity&#x27;</span><br><span class="line">network:</span><br><span class="line">  ethernets:</span><br><span class="line">    ens33:</span><br><span class="line">      addresses: [192.168.10.11/24]</span><br><span class="line">      #gateway4: 192.168.10.1</span><br><span class="line">      #nameservers:</span><br><span class="line">      #  addresses: [192.168.10.1]</span><br><span class="line">      dhcp4: no</span><br><span class="line">    ens38:</span><br><span class="line">      addresses: [192.168.227.5/24]</span><br><span class="line">      dhcp4: yes</span><br><span class="line">  version: 2</span><br></pre></td></tr></table></figure>
<ul>
<li>其中 <code>ens33</code> 是桥接网卡，配置文件中仅为其配置了静态IP地址，并关闭了dhcpv4，其余的网关、DNS等配置被注释掉是因为如果保留的话，<code>netplan</code> 将为根据设定的网关添加默认路由，而且该默认路由的优先级比 <code>ens38</code> 的默认路由要高，导致各种外网请求走没有互联网连接的 <code>ens33</code>。这里只为 <code>ens33</code> 配置IP，不配置网关，就可以避免 <code>netplan</code> 添加相应的默认路由。</li>
<li><code>ens38</code> 本来采取的是纯静态配置，结果无法访问互联网，原因在上面讨论了，这里采用了较为稳妥的 <code>DHCP + 静态IP</code> 的方法，既能通过固定IP便捷访问，又能借助DHCP自动配置网关和DNS。</li>
</ul>
<h2 id="树莓派配置MacVLAN虚拟接口"><a href="#树莓派配置MacVLAN虚拟接口" class="headerlink" title="树莓派配置MacVLAN虚拟接口"></a>树莓派配置MacVLAN虚拟接口</h2><p>之前使用路由器多拨时接触过MacVLAN，感觉十分神奇，居然可以通过一个实体网络接口拓展出众多虚拟接口，并且每个都可以拥有自己的Mac地址和IP，而多拨原理就是每个虚拟接口都拨号，然后带宽叠加。</p>
<p>最近了解到相关虚拟技术是由Linux内核提供支持的，从最初的TUN/TAP，发展到后来的MacVLAN和MacVTap，原本我是打算创建一个MacVTap虚拟接口的，结果好像报错说不支持该类型，就用了MacVLAN，并顺利为虚拟接口配置了IP，经测试可以连通。</p>
<p>配置工具就是一系列 ip 命令，在此不再赘述。下图当中的 <code>macvlan0@eth0</code> 即为基于 <code>eth0</code> 的虚拟网络接口，需要注意的一点是，在使用 ip 命令配置的过程中，使用 <code>macvlan0</code> 引用虚拟网卡，不需要带也不能带 <code>@eth0</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/20210725023126.png" alt=""></p>
<h2 id="为什么网络接口、交换机可以虚拟化？"><a href="#为什么网络接口、交换机可以虚拟化？" class="headerlink" title="为什么网络接口、交换机可以虚拟化？"></a>为什么网络接口、交换机可以虚拟化？</h2><p>以前没有仔细考虑过这件事情，感觉很神奇，在这里简单地说一下现在的想法。</p>
<p>先来回顾一下交换机工作原理：</p>
<blockquote>
<p>交换机工作于OSI参考模型中的第二层（数据链路层），交换机的工作依赖于对MAC地址的识别（所有的网络设备都有一个唯一的MAC地址，通常是由厂商直接烧录进网卡中）。<br>当交换机从其某个端口收到一个数据包时，先读取包头中的源MAC地址（即发送该数据包的设备网卡的MAC地址），将该MAC地址和端口对应起来添加到交换机内存里的地址表中；然后再读取包头中的目的MAC地址，对照内存里的地址表看该MAC地址与哪个端口对应，如果地址表中有该MAC地址的对应端口，则将该数据包直接复制到对应的端口上，如果没有找到，则将该数据帧作为一个广播帧发送到所有的端口，对应的MAC地址设备会自动接受该帧数据，同时，交换机将接受该帧数据的端口与这个目的MAC地址对应起来放入内存中的地址表中。</p>
</blockquote>
<p>简单地说交换机的作用就是转发MAC帧，物理交换机可以用于在一些物理接口之间转发MAC帧。</p>
<p>那么网络接口如何实现虚拟化呢？在没有虚拟接口的情况下，一个网卡对应一个MAC地址，交换机按照转发表，把对应的MAC帧发送到特定的物理端口。只要在此基础上，允许一个物理网卡对应多个MAC地址，那么每个MAC地址都可以配置一个虚拟接口，物理网卡所属机器在拿到MAC帧之后，再根据具体内容分发到虚拟接口即可。而一个物理网卡对应多个MAC地址其实只要允许交换机转发表中一个接口对应多个表项即可。</p>
<p>上面说的是数据链路层的虚拟化，只要实现了数据链路层的虚拟化，那么每个虚拟接口都可以独立地实现局域网通信了，它们是物理端口还是虚拟端口对于上层协议栈来说其实是透明的。</p>
<p>如果接口是用软件虚拟的，那么自然地，就可以同样利用软件在这些虚拟接口间转发MAC帧，这些软件就相当于虚拟交换机了？</p>
<h2 id="参考资料-amp-相关链接"><a href="#参考资料-amp-相关链接" class="headerlink" title="参考资料&amp;相关链接"></a>参考资料&amp;相关链接</h2><p><a target="_blank" rel="noopener" href="https://suhu0426.github.io/Web/Presentation/20150120/index.html">Virtual networking: TUN/TAP, MacVLAN, and MacVTap</a><br><a target="_blank" rel="noopener" href="http://kms2.h3c.com/View.aspx?id=40366">虚拟交换机（vSwitch）原理及配置</a><br><a target="_blank" rel="noopener" href="https://www.openvswitch.org/">Open vSwitch</a><br><a target="_blank" rel="noopener" href="https://virt.kernelnewbies.org/MacVTap">MacVTap - Linux Virtualization Wiki</a><br><a target="_blank" rel="noopener" href="https://sreeninet.wordpress.com/2016/05/29/macvlan-and-ipvlan/">Macvlan and IPvlan basics</a>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lpypl.top/2021/07/10/Win10%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
      <meta itemprop="name" content="Liu Peiyuan">
      <meta itemprop="description" content="刘沛源的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/10/Win10%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">Win10配置过程记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-10 15:15:00" itemprop="dateCreated datePublished" datetime="2021-07-10T15:15:00+08:00">2021-07-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-22 00:27:23" itemprop="dateModified" datetime="2025-09-22T00:27:23+08:00">2025-09-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tutorial/" itemprop="url" rel="index"><span itemprop="name">Tutorial</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/07/10/Win10%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/07/10/Win10配置过程记录/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>由于原来的系统出了一些问题，今日重装了Windows10系统，下面简要记录一下各种基本设定以及开发环境的配置过程，供今后参考。</p>
<h2 id="系统安装"><a href="#系统安装" class="headerlink" title="系统安装"></a>系统安装</h2><h3 id="如何让Win10在系统盘重建ESP分区？"><a href="#如何让Win10在系统盘重建ESP分区？" class="headerlink" title="如何让Win10在系统盘重建ESP分区？"></a>如何让Win10在系统盘重建ESP分区？</h3><p>系统安装基本没什么好说的，只是需要注意如果有多块磁盘，并且其中一个磁盘存在ESP分区（Fat32），则在重装Win10时，即使选择安装到另一块未分区的磁盘，似乎Win10安装器也不会在另一块磁盘重建ESP分区，而会使用已有的ESP分区，如果想要Win10安装器在操作系统所在磁盘重建ESP分区，可以把另一块磁盘的ESP分区删掉。</p>
<p>对于无洁癖用户大可不必这样操作，不过给Win10预留一个未分区磁盘，还是比分好一个NTFS分区给它用要好的， 这样Win10安装器似乎会建立好几个分区，也许多余的分区是用于系统恢复的。</p>
<h3 id="UEFI启动项管理软件"><a href="#UEFI启动项管理软件" class="headerlink" title="UEFI启动项管理软件"></a>UEFI启动项管理软件</h3><ul>
<li>*nix系统建议直接使用 <code>efibootmgr</code>，至少Arch系、Debian系的系统都自带这个工具。  </li>
<li>Windows系统可以用 <code>EasyUEFI</code>，不过试用版过期后就没法用了，即使重装、删除注册表项，也难以重新试用，可以用pj版。  </li>
</ul>
<h3 id="指定用户名"><a href="#指定用户名" class="headerlink" title="指定用户名"></a>指定用户名</h3><p>如果按照Win10默认的引导进行配置，它会诱导用户登录微软账户，并自动把微软账户名的前缀（邮箱前缀）作为系统用户名，作为一个经常使用终端的CSer，是无法容忍奇奇怪怪的用户名的。  </p>
<p>如果想要自定义用户名，需要先以本地账户登录，自己起一个用户名，之后再切换到微软账户登录即可。</p>
<h2 id="初始配置"><a href="#初始配置" class="headerlink" title="初始配置"></a>初始配置</h2><h3 id="卸载自带应用"><a href="#卸载自带应用" class="headerlink" title="卸载自带应用"></a>卸载自带应用</h3><p>卸载一系列自带的无用软件。</p>
<h3 id="Onedrive同步"><a href="#Onedrive同步" class="headerlink" title="Onedrive同步"></a>Onedrive同步</h3><p>登录Onedrive并开启个人文件夹同步，打开 <strong>文档</strong> 文件夹的同步功能，这样应该可以实现微信和QQ聊天记录的同步，写此文时尚未安装QQ和微信，所以不是特别确定。</p>
<h2 id="WSL2配置"><a href="#WSL2配置" class="headerlink" title="WSL2配置"></a>WSL2配置</h2><p>本次重装彻底删掉了Ubuntu系统，打算迁移到WSL2，毕竟双系统切换太麻烦了。  </p>
<h3 id="WSL2安装"><a href="#WSL2安装" class="headerlink" title="WSL2安装"></a>WSL2安装</h3><p>按照官方教程配置即可，主要步骤大概如下：</p>
<ul>
<li>开启两项可选功能： Linux子系统 和 虚拟化平台</li>
<li>下载安装最新的 WSL2 Linux内核升级包</li>
<li>设置wsl默认版本为wsl2</li>
<li>安装所需发行版</li>
</ul>
<h3 id="如何从主机访问WSL2？"><a href="#如何从主机访问WSL2？" class="headerlink" title="如何从主机访问WSL2？"></a>如何从主机访问WSL2？</h3><p>由于wsl2的ip地址是动态配置的，而自动端口映射功能也并不稳定，为了便捷地从win10访问wsl2，一种可靠的方案是动态获取wsl2的ip地址并在win10的hosts文件中为其设置域名。  </p>
<p><a target="_blank" rel="noopener" href="https://github.com/shayne/go-wsl2-host.git">go-wsl2-host</a> 项目实现了这个功能，参照项目说明进行配置,使用时可能会遇到一些问题：  </p>
<ul>
<li>服务启动失败：检查用户名和密码，用户名基本就是个人文件夹的名字，密码为微软账户密码  </li>
<li>账号密码正确仍无法登录：<code>开始-&gt;Windows管理工具-&gt;本地安全策略-&gt;本地策略-&gt;用户权限分配-&gt;作为服务登录-&gt;添加用户或组</code>，把相应用户添加进去  </li>
<li>服务启动成功，但hosts文件却没变：可以使用 <code>wsl2host debug</code> 命令查看程序输出，如果程序提示无法写入hosts，检查hosts文件是否为只读，把只读属性取消即可。hosts路径为 <code>C:\Windows\System32\drivers\etc\hosts</code>  </li>
</ul>
<h3 id="自动启动WSL2，以及其中的一些服务"><a href="#自动启动WSL2，以及其中的一些服务" class="headerlink" title="自动启动WSL2，以及其中的一些服务"></a>自动启动WSL2，以及其中的一些服务</h3><p>WSL2不支持systemd，也就无法通过systemctl配置自启服务，可以在 <code>/etc/init.wsl</code> 中写入一些启动服务的命令，并在Windows中配置开机执行 <code>wsl -u root /etc/init.wsl</code>。可以利用Win10的 <code>任务计划程序</code> 配置执行上述命令。</p>
<p>我导出的任务计划程序配置（wsl2-init.xml）如下:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-16&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Task</span> <span class="attr">version</span>=<span class="string">&quot;1.2&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/windows/2004/02/mit/task&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">RegistrationInfo</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Date</span>&gt;</span>2021-07-01T20:23:06.8672886<span class="tag">&lt;/<span class="name">Date</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Author</span>&gt;</span>OMEN\lpyhe<span class="tag">&lt;/<span class="name">Author</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Description</span>&gt;</span>Windows开机时自动运行WSL2并且运行 /etc/init.wsl<span class="tag">&lt;/<span class="name">Description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">URI</span>&gt;</span>\Custom\WSL-INIT<span class="tag">&lt;/<span class="name">URI</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">RegistrationInfo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Triggers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">BootTrigger</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">Enabled</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">BootTrigger</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Triggers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Principals</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Principal</span> <span class="attr">id</span>=<span class="string">&quot;Author&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">UserId</span>&gt;</span>S-1-5-21-226882884-566579671-1051654333-1001<span class="tag">&lt;/<span class="name">UserId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">LogonType</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">LogonType</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RunLevel</span>&gt;</span>LeastPrivilege<span class="tag">&lt;/<span class="name">RunLevel</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Principal</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Principals</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MultipleInstancesPolicy</span>&gt;</span>IgnoreNew<span class="tag">&lt;/<span class="name">MultipleInstancesPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DisallowStartIfOnBatteries</span>&gt;</span>true<span class="tag">&lt;/<span class="name">DisallowStartIfOnBatteries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">StopIfGoingOnBatteries</span>&gt;</span>true<span class="tag">&lt;/<span class="name">StopIfGoingOnBatteries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AllowHardTerminate</span>&gt;</span>true<span class="tag">&lt;/<span class="name">AllowHardTerminate</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">StartWhenAvailable</span>&gt;</span>false<span class="tag">&lt;/<span class="name">StartWhenAvailable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RunOnlyIfNetworkAvailable</span>&gt;</span>false<span class="tag">&lt;/<span class="name">RunOnlyIfNetworkAvailable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">IdleSettings</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">StopOnIdleEnd</span>&gt;</span>true<span class="tag">&lt;/<span class="name">StopOnIdleEnd</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RestartOnIdle</span>&gt;</span>false<span class="tag">&lt;/<span class="name">RestartOnIdle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">IdleSettings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AllowStartOnDemand</span>&gt;</span>true<span class="tag">&lt;/<span class="name">AllowStartOnDemand</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">Enabled</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Hidden</span>&gt;</span>false<span class="tag">&lt;/<span class="name">Hidden</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RunOnlyIfIdle</span>&gt;</span>false<span class="tag">&lt;/<span class="name">RunOnlyIfIdle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">WakeToRun</span>&gt;</span>false<span class="tag">&lt;/<span class="name">WakeToRun</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ExecutionTimeLimit</span>&gt;</span>PT72H<span class="tag">&lt;/<span class="name">ExecutionTimeLimit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Priority</span>&gt;</span>7<span class="tag">&lt;/<span class="name">Priority</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Actions</span> <span class="attr">Context</span>=<span class="string">&quot;Author&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Exec</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Command</span>&gt;</span>wsl<span class="tag">&lt;/<span class="name">Command</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Arguments</span>&gt;</span>-u root /etc/init.wsl<span class="tag">&lt;/<span class="name">Arguments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Exec</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Actions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Task</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Windows-Terminal-中-wsl自动进入"><a href="#Windows-Terminal-中-wsl自动进入" class="headerlink" title="Windows Terminal 中 wsl自动进入 ~"></a>Windows Terminal 中 wsl自动进入 <code>~</code></h3><p>在windows terminal中配置wsl的启动目录为 <code>//wsl$/Ubuntu-20.04/home/用户名/</code>，可能需要根据实际情况修改wsl名称和用户名。</p>
<h2 id="Win10-实用软件"><a href="#Win10-实用软件" class="headerlink" title="Win10 实用软件"></a>Win10 实用软件</h2><h3 id="WinSW-设置守护服务"><a href="#WinSW-设置守护服务" class="headerlink" title="WinSW: 设置守护服务"></a>WinSW: 设置守护服务</h3><p>Win10配置守护服务不像Debian、Arch的systemd那样方便，可以借助第三方程序实现，比如 <a target="_blank" rel="noopener" href="https://github.com/winsw/winsw.git">WinSW</a>。</p>
<p>下面是一个将frpc配置为服务的配置示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- ID of the service. It should be unique across the Windows system--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>frpc<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Display name of the service --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>frpc<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Service description --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>frpc<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- Path to the executable, which should be started --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executable</span>&gt;</span>C:\Programs\Frpc\frpc.exe<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">arguments</span>&gt;</span>-c C:\Programs\Frpc\frpc.ini<span class="tag">&lt;/<span class="name">arguments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">onfailure</span> <span class="attr">action</span>=<span class="string">&quot;restart&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="AutohotKey-配置快捷键"><a href="#AutohotKey-配置快捷键" class="headerlink" title="AutohotKey: 配置快捷键"></a>AutohotKey: 配置快捷键</h3><p>可用于配置快捷键，下面的脚本将 <code>Ctrl + Alt + T</code> 配置为启动<code>Windows Terminal</code>的快捷键。将写好的ahk脚本放到 <code>C:\Users\用户名\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</code> 中即可开机自启。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">^!t::</span><br><span class="line">Run, wt.exe</span><br><span class="line">return</span><br></pre></td></tr></table></figure>
<h2 id="WSL2子系统环境配置"><a href="#WSL2子系统环境配置" class="headerlink" title="WSL2子系统环境配置"></a>WSL2子系统环境配置</h2><h3 id="使用python3作为默认python"><a href="#使用python3作为默认python" class="headerlink" title="使用python3作为默认python"></a>使用python3作为默认python</h3><p>推荐使用 <code>update-alternatives</code> 进行配置，这样便于管理。为python3添加alternatives的命令为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 30</span><br></pre></td></tr></table></figure>
<h3 id="vim配置"><a href="#vim配置" class="headerlink" title="vim配置"></a>vim配置</h3><p> 首先安装 <a target="_blank" rel="noopener" href="https://github.com/junegunn/vim-plug.git">vim-plug</a>，然后准备好vim配置文件 <code>~/.config/nvim/init.vim</code>， 接下来启动 <code>vim</code> 等待各种插件安装完成，其中Coc插件需要高版本的node，官方源版本过低，参考下一条进行node的安装。</p>
<p> 我的Vim配置文件：</p>
 <figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&quot; setting</span></span><br><span class="line"><span class="comment">&quot; setting - basic</span></span><br><span class="line"><span class="keyword">set</span> nocompatible</span><br><span class="line"><span class="keyword">set</span> encoding=utf8</span><br><span class="line"><span class="keyword">set</span> showcmd</span><br><span class="line"><span class="keyword">set</span> hls</span><br><span class="line"><span class="keyword">set</span> relativenumber</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">number</span></span><br><span class="line"><span class="keyword">syntax</span> <span class="keyword">on</span></span><br><span class="line"><span class="comment">&quot; setting - tab &amp; indent</span></span><br><span class="line"><span class="keyword">set</span> tabstop=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> softtabstop=<span class="number">0</span></span><br><span class="line"><span class="keyword">set</span> <span class="built_in">shiftwidth</span>=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> expandtab</span><br><span class="line"><span class="keyword">set</span> autoindent</span><br><span class="line"><span class="keyword">set</span> smartindent</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; keymap</span></span><br><span class="line"><span class="keyword">let</span> mapleader=<span class="string">&quot;,&quot;</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;Leader&gt;</span>t :NERDTreeToggle<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;Leader&gt;</span><span class="keyword">w</span> :<span class="keyword">w</span><span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;Leader&gt;</span>q :q<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="comment">&quot; nmap &lt;Leader&gt;, 10&lt;C-w&gt;&lt;</span></span><br><span class="line"><span class="comment">&quot; nmap &lt;Leader&gt;. 10&lt;C-w&gt;&gt;</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;Leader&gt;</span>- <span class="number">5</span><span class="symbol">&lt;C-w&gt;</span>-</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;Leader&gt;</span>= <span class="number">5</span><span class="symbol">&lt;C-w&gt;</span>+</span><br><span class="line"><span class="comment">&quot; nmap &lt;Leader&gt;i :bn&lt;CR&gt;</span></span><br><span class="line"><span class="comment">&quot; nmap &lt;Leader&gt;o :bN&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;C-L&gt;</span> <span class="symbol">&lt;Del&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; tnoremap &lt;A-h&gt; &lt;C-\&gt;&lt;C-N&gt;&lt;C-w&gt;h</span></span><br><span class="line"><span class="comment">&quot; tnoremap &lt;A-j&gt; &lt;C-\&gt;&lt;C-N&gt;&lt;C-w&gt;j</span></span><br><span class="line"><span class="comment">&quot; tnoremap &lt;A-k&gt; &lt;C-\&gt;&lt;C-N&gt;&lt;C-w&gt;k</span></span><br><span class="line"><span class="comment">&quot; tnoremap &lt;A-l&gt; &lt;C-\&gt;&lt;C-N&gt;&lt;C-w&gt;l</span></span><br><span class="line"><span class="comment">&quot; inoremap &lt;A-h&gt; &lt;C-\&gt;&lt;C-N&gt;&lt;C-w&gt;h</span></span><br><span class="line"><span class="comment">&quot; inoremap &lt;A-j&gt; &lt;C-\&gt;&lt;C-N&gt;&lt;C-w&gt;j</span></span><br><span class="line"><span class="comment">&quot; inoremap &lt;A-k&gt; &lt;C-\&gt;&lt;C-N&gt;&lt;C-w&gt;k</span></span><br><span class="line"><span class="comment">&quot; inoremap &lt;A-l&gt; &lt;C-\&gt;&lt;C-N&gt;&lt;C-w&gt;l</span></span><br><span class="line"><span class="comment">&quot; nnoremap &lt;A-h&gt; &lt;C-w&gt;h</span></span><br><span class="line"><span class="comment">&quot; nnoremap &lt;A-j&gt; &lt;C-w&gt;j</span></span><br><span class="line"><span class="comment">&quot; nnoremap &lt;A-k&gt; &lt;C-w&gt;k</span></span><br><span class="line"><span class="comment">&quot; nnoremap &lt;A-l&gt; &lt;C-w&gt;l</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; use h,i,j,k move cursor in insert mode</span></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;A-h&gt;</span> <span class="symbol">&lt;C-o&gt;</span>h</span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;A-j&gt;</span> <span class="symbol">&lt;C-o&gt;</span><span class="keyword">j</span></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;A-k&gt;</span> <span class="symbol">&lt;C-o&gt;</span><span class="keyword">k</span></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;A-l&gt;</span> <span class="symbol">&lt;C-o&gt;</span><span class="keyword">l</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; use h,i,j,k switch window in normal mode</span></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;A-h&gt;</span> <span class="symbol">&lt;C-w&gt;</span>h</span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;A-j&gt;</span> <span class="symbol">&lt;C-w&gt;</span><span class="keyword">j</span></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;A-k&gt;</span> <span class="symbol">&lt;C-w&gt;</span><span class="keyword">k</span></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;A-l&gt;</span> <span class="symbol">&lt;C-w&gt;</span><span class="keyword">l</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; 在使用CTRL-U 和 CTRL-H时开启新的undo</span></span><br><span class="line"><span class="comment">&quot; 防止意外删除字符却不可undo</span></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;C-H&gt;</span> <span class="symbol">&lt;C-G&gt;</span><span class="keyword">u</span><span class="symbol">&lt;C-H&gt;</span></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;C-U&gt;</span> <span class="symbol">&lt;C-G&gt;</span><span class="keyword">u</span><span class="symbol">&lt;C-U&gt;</span></span><br><span class="line"></span><br><span class="line">tnoremap <span class="symbol">&lt;Esc&gt;</span> &lt;C-\&gt;<span class="symbol">&lt;C-N&gt;</span></span><br><span class="line"></span><br><span class="line">tnoremap <span class="symbol">&lt;A-n&gt;</span> &lt;C-\&gt;<span class="symbol">&lt;C-N&gt;</span>gt</span><br><span class="line">tnoremap <span class="symbol">&lt;A-p&gt;</span> &lt;C-\&gt;<span class="symbol">&lt;C-N&gt;</span>gT</span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;A-n&gt;</span> &lt;C-\&gt;<span class="symbol">&lt;C-N&gt;</span>gt</span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;A-p&gt;</span> &lt;C-\&gt;<span class="symbol">&lt;C-N&gt;</span>gT</span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;A-n&gt;</span> gt </span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;A-p&gt;</span> gT</span><br><span class="line"></span><br><span class="line"><span class="keyword">augroup</span> terminal</span><br><span class="line">    autocmd!</span><br><span class="line">    <span class="keyword">autocmd</span> TermOpen * <span class="keyword">setlocal</span> nonumber</span><br><span class="line">    <span class="keyword">autocmd</span> TermOpen * <span class="keyword">setlocal</span> norelativenumber</span><br><span class="line">    <span class="keyword">autocmd</span> TermOpen * <span class="keyword">setlocal</span> signcolumn=<span class="keyword">no</span></span><br><span class="line"><span class="keyword">augroup</span> end</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; for cpp</span></span><br><span class="line"><span class="keyword">function!</span> <span class="title">CompileAndRun</span><span class="params">()</span> </span><br><span class="line">    <span class="keyword">write</span></span><br><span class="line">    <span class="keyword">execute</span> <span class="built_in">printf</span>(<span class="string">&quot;!g++ -std=c++11 -Wall %s -o %s &amp;&amp; %s&quot;</span>, <span class="built_in">expand</span>(<span class="string">&quot;%:p&quot;</span>), <span class="built_in">expand</span>(<span class="string">&quot;%:p:r&quot;</span>), <span class="built_in">expand</span>(<span class="string">&quot;%:p:r&quot;</span>))</span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">autocmd</span> <span class="keyword">filetype</span> cpp command! CompileAndRun <span class="keyword">call</span> CompileAndRun()</span><br><span class="line"><span class="keyword">autocmd</span> <span class="keyword">filetype</span> cpp <span class="keyword">nnoremap</span> <span class="symbol">&lt;Leader&gt;</span>r :CompileAndRun<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; vim-plug</span></span><br><span class="line"><span class="keyword">call</span> plug#begin(stdpath(<span class="string">&#x27;data&#x27;</span>) . <span class="string">&#x27;/plugged&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Make sure you are using single quotes</span></span><br><span class="line">Plug <span class="string">&#x27;neoclide/coc.nvim&#x27;</span>, &#123;<span class="string">&#x27;branch&#x27;</span>: <span class="string">&#x27;release&#x27;</span>&#125;</span><br><span class="line">Plug <span class="string">&#x27;vim-airline/vim-airline&#x27;</span></span><br><span class="line">Plug <span class="string">&#x27;vim-airline/vim-airline-themes&#x27;</span></span><br><span class="line">Plug <span class="string">&#x27;Yggdroot/LeaderF&#x27;</span></span><br><span class="line">Plug <span class="string">&#x27;wakatime/vim-wakatime&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; On-demand loading</span></span><br><span class="line">Plug <span class="string">&#x27;scrooloose/nerdtree&#x27;</span>, &#123; <span class="string">&#x27;on&#x27;</span>:  <span class="string">&#x27;NERDTreeToggle&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Always load the vim-devicons as th very last one</span></span><br><span class="line">Plug <span class="string">&#x27;ryanoasis/vim-devicons&#x27;</span></span><br><span class="line"><span class="keyword">call</span> plug#end()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:airline_powerline_fonts</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:airline_theme</span>=<span class="string">&#x27;bubblegum&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; &gt;&gt;&gt; FOR COC &gt;&gt;&gt;</span></span><br><span class="line"><span class="comment">&quot; TextEdit might fail if hidden is not set</span></span><br><span class="line"><span class="keyword">set</span> hidden</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Some servers have issue with backup files, see #649</span></span><br><span class="line"><span class="keyword">set</span> nobackup</span><br><span class="line"><span class="keyword">set</span> nowritebackup</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Give more space for display messages</span></span><br><span class="line"><span class="keyword">set</span> cmdheight=<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot; Having longer updatetime (default is 4000 ms = 4 s) leads to noticeable&quot;</span></span><br><span class="line"><span class="comment">&quot; delays and poor user experience</span></span><br><span class="line"><span class="keyword">set</span> updatetime=<span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Don&#x27;t pass messages to |ins-completion-menu|</span></span><br><span class="line"><span class="keyword">set</span> shortmess+=<span class="keyword">c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Always show the signcolumn, otherwise it would shift the text each time</span></span><br><span class="line"><span class="comment">&quot; diagnostics appear/become resolved.</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">&quot;patch-8.1.1564&quot;</span>)</span><br><span class="line">  <span class="comment">&quot; Recently vim can merge signcolumn and number column into one</span></span><br><span class="line">  <span class="keyword">set</span> signcolumn=<span class="keyword">number</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="keyword">set</span> signcolumn=yes</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Use tab for trigger completion with characters ahead and navigate.</span></span><br><span class="line"><span class="comment">&quot; <span class="doctag">NOTE:</span> Use command &#x27;:verbose imap &lt;tab&gt;&#x27; to make sure tab is not mapped by</span></span><br><span class="line"><span class="comment">&quot; other plugin before putting this into your config.</span></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;silent&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;TAB&gt;</span></span><br><span class="line">      \ <span class="built_in">pumvisible</span>() ? <span class="string">&quot;\&lt;C-n&gt;&quot;</span> :</span><br><span class="line">      \ <span class="symbol">&lt;SID&gt;</span>check_back_space() ? <span class="string">&quot;\&lt;TAB&gt;&quot;</span> :</span><br><span class="line">      \ coc#refresh()</span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;expr&gt;</span><span class="symbol">&lt;S-TAB&gt;</span> <span class="built_in">pumvisible</span>() ? <span class="string">&quot;\&lt;C-p&gt;&quot;</span> : <span class="string">&quot;\&lt;C-h&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function!</span> <span class="title">s</span>:check_back_space<span class="params">()</span> abort</span><br><span class="line">  <span class="keyword">let</span> <span class="keyword">col</span> = <span class="keyword">col</span>(<span class="string">&#x27;.&#x27;</span>) - <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> !col || <span class="built_in">getline</span>(<span class="string">&#x27;.&#x27;</span>)[<span class="keyword">col</span> - <span class="number">1</span>]  =~# <span class="string">&#x27;\s&#x27;</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Use &lt;c-space&gt; to trigger completion.</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">&#x27;nvim&#x27;</span>)</span><br><span class="line">  <span class="keyword">inoremap</span> <span class="symbol">&lt;silent&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;c-space&gt;</span> coc#refresh()</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="keyword">inoremap</span> <span class="symbol">&lt;silent&gt;</span><span class="symbol">&lt;expr&gt;</span> &lt;<span class="keyword">c</span>-@&gt; coc#refresh()</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Use [g and ]g to navigate diagnostics</span></span><br><span class="line"><span class="comment">&quot; use :CocDiagnostics to get all diagnostics of current buffer in location list</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> [g <span class="symbol">&lt;Plug&gt;</span>(coc-diagnostic-<span class="keyword">prev</span>)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> ]g <span class="symbol">&lt;Plug&gt;</span>(coc-diagnostic-<span class="keyword">next</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; GoTo code navigation.</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> gd <span class="symbol">&lt;Plug&gt;</span>(coc-definition)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> gy <span class="symbol">&lt;Plug&gt;</span>(coc-<span class="built_in">type</span>-definition)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> gi <span class="symbol">&lt;Plug&gt;</span>(coc-implementation)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> <span class="keyword">gr</span> <span class="symbol">&lt;Plug&gt;</span>(coc-references)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Use K to show documentation in preview window.</span></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;silent&gt;</span> K :<span class="keyword">call</span> <span class="symbol">&lt;SID&gt;</span>show_documentation()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function!</span> <span class="title">s</span>:show_documentation<span class="params">()</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">index</span>([<span class="string">&#x27;vim&#x27;</span>,<span class="string">&#x27;help&#x27;</span>], &amp;<span class="keyword">filetype</span>) &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">execute</span> <span class="string">&#x27;h &#x27;</span>.<span class="built_in">expand</span>(<span class="string">&#x27;&lt;cword&gt;&#x27;</span>)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">call</span> CocActionAsync(<span class="string">&#x27;doHover&#x27;</span>)</span><br><span class="line">  <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Highlight the symbol and its references when holding the cursor.</span></span><br><span class="line"><span class="keyword">autocmd</span> CursorHold * <span class="keyword">silent</span> <span class="keyword">call</span> CocActionAsync(<span class="string">&#x27;highlight&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Symbol renaming.</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span>rn <span class="symbol">&lt;Plug&gt;</span>(coc-<span class="built_in">rename</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Formatting selected code.</span></span><br><span class="line"><span class="comment">&quot; xmap &lt;leader&gt;f  &lt;Plug&gt;(coc-format)</span></span><br><span class="line"><span class="comment">&quot; nmap &lt;leader&gt;f  &lt;Plug&gt;(coc-format)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">augroup</span> mygroup</span><br><span class="line">  autocmd!</span><br><span class="line">  <span class="comment">&quot; Setup formatexpr specified filetype(s).</span></span><br><span class="line">  <span class="keyword">autocmd</span> FileType typescript,json <span class="keyword">setl</span> formatexpr=CocAction(<span class="string">&#x27;formatSelected&#x27;</span>)</span><br><span class="line">  <span class="comment">&quot; Update signature help on jump placeholder.</span></span><br><span class="line">  <span class="keyword">autocmd</span> User CocJumpPlaceholder <span class="keyword">call</span> CocActionAsync(<span class="string">&#x27;showSignatureHelp&#x27;</span>)</span><br><span class="line"><span class="keyword">augroup</span> end</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Applying codeAction to the selected region.</span></span><br><span class="line"><span class="comment">&quot; Example: `&lt;leader&gt;aap` for current paragraph</span></span><br><span class="line"><span class="keyword">xmap</span> <span class="symbol">&lt;leader&gt;</span><span class="keyword">a</span>  <span class="symbol">&lt;Plug&gt;</span>(coc-codeaction-selected)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span><span class="keyword">a</span>  <span class="symbol">&lt;Plug&gt;</span>(coc-codeaction-selected)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Remap keys for applying codeAction to the current buffer.</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span>ac  <span class="symbol">&lt;Plug&gt;</span>(coc-codeaction)</span><br><span class="line"><span class="comment">&quot; Apply AutoFix to problem on the current line.</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span>qf  <span class="symbol">&lt;Plug&gt;</span>(coc-<span class="keyword">fix</span>-current)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Map function and class text objects</span></span><br><span class="line"><span class="comment">&quot; <span class="doctag">NOTE:</span> Requires &#x27;textDocument.documentSymbol&#x27; support from the language server.</span></span><br><span class="line"><span class="keyword">xmap</span> <span class="keyword">if</span> <span class="symbol">&lt;Plug&gt;</span>(coc-funcobj-i)</span><br><span class="line"><span class="keyword">omap</span> <span class="keyword">if</span> <span class="symbol">&lt;Plug&gt;</span>(coc-funcobj-i)</span><br><span class="line"><span class="keyword">xmap</span> af <span class="symbol">&lt;Plug&gt;</span>(coc-funcobj-<span class="keyword">a</span>)</span><br><span class="line"><span class="keyword">omap</span> af <span class="symbol">&lt;Plug&gt;</span>(coc-funcobj-<span class="keyword">a</span>)</span><br><span class="line"><span class="keyword">xmap</span> ic <span class="symbol">&lt;Plug&gt;</span>(coc-classobj-i)</span><br><span class="line"><span class="keyword">omap</span> ic <span class="symbol">&lt;Plug&gt;</span>(coc-classobj-i)</span><br><span class="line"><span class="keyword">xmap</span> ac <span class="symbol">&lt;Plug&gt;</span>(coc-classobj-<span class="keyword">a</span>)</span><br><span class="line"><span class="keyword">omap</span> ac <span class="symbol">&lt;Plug&gt;</span>(coc-classobj-<span class="keyword">a</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Remap &lt;C-f&gt; and &lt;C-b&gt; for scroll float windows/popups.</span></span><br><span class="line"><span class="comment">&quot; Note coc#float#scroll works on neovim &gt;= 0.4.0 or vim &gt;= 8.2.0750</span></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;nowait&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;C-f&gt;</span> coc#float#has_scroll() ? coc#float#scroll(<span class="number">1</span>) : <span class="string">&quot;\&lt;C-f&gt;&quot;</span></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;nowait&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;C-b&gt;</span> coc#float#has_scroll() ? coc#float#scroll(<span class="number">0</span>) : <span class="string">&quot;\&lt;C-b&gt;&quot;</span></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;nowait&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;C-f&gt;</span> coc#float#has_scroll() ? <span class="string">&quot;\&lt;c-r&gt;=coc#float#scroll(1)\&lt;cr&gt;&quot;</span> : <span class="string">&quot;\&lt;Right&gt;&quot;</span></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;nowait&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;C-b&gt;</span> coc#float#has_scroll() ? <span class="string">&quot;\&lt;c-r&gt;=coc#float#scroll(0)\&lt;cr&gt;&quot;</span> : <span class="string">&quot;\&lt;Left&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; NeoVim-only mapping for visual mode scroll</span></span><br><span class="line"><span class="comment">&quot; Useful on signatureHelp after jump placeholder of snippet expansion</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">&#x27;nvim&#x27;</span>)</span><br><span class="line">  <span class="keyword">vnoremap</span> <span class="symbol">&lt;nowait&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;C-f&gt;</span> coc#float#has_scroll() ? coc#float#nvim_scroll(<span class="number">1</span>, <span class="number">1</span>) : <span class="string">&quot;\&lt;C-f&gt;&quot;</span></span><br><span class="line">  <span class="keyword">vnoremap</span> <span class="symbol">&lt;nowait&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;C-b&gt;</span> coc#float#has_scroll() ? coc#float#nvim_scroll(<span class="number">0</span>, <span class="number">1</span>) : <span class="string">&quot;\&lt;C-b&gt;&quot;</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Use CTRL-S for selections ranges.</span></span><br><span class="line"><span class="comment">&quot; Requires &#x27;textDocument/selectionRange&#x27; support of language server.</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;C-s&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(coc-<span class="built_in">range</span>-select)</span><br><span class="line"><span class="keyword">xmap</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;C-s&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(coc-<span class="built_in">range</span>-select)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Add `:Format` command to format current buffer.</span></span><br><span class="line">command! -nargs=<span class="number">0</span> Format :<span class="keyword">call</span> CocAction(<span class="string">&#x27;format&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Add `:Fold` command to fold current buffer.</span></span><br><span class="line">command! -nargs=? Fold :<span class="keyword">call</span> CocAction(<span class="string">&#x27;fold&#x27;</span>, <span class="symbol">&lt;f-args&gt;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Add `:OR` command for organize imports of the current buffer.</span></span><br><span class="line">command! -nargs=<span class="number">0</span> OR :<span class="keyword">call</span> CocAction(<span class="string">&#x27;runCommand&#x27;</span>, <span class="string">&#x27;editor.action.organizeImport&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; &gt;&gt;&gt; config for coc &gt;&gt;&gt;</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:coc_global_extensions</span> = [<span class="string">&#x27;coc-tsserver&#x27;</span>, <span class="string">&#x27;coc-html&#x27;</span>, <span class="string">&#x27;coc-css&#x27;</span>, <span class="string">&#x27;coc-json&#x27;</span>,</span><br><span class="line">	\ <span class="string">&#x27;coc-python&#x27;</span>, <span class="string">&#x27;coc-xml&#x27;</span>, <span class="string">&#x27;coc-yaml&#x27;</span>, <span class="string">&#x27;coc-markdownlint&#x27;</span>, <span class="string">&#x27;coc-highlight&#x27;</span>,</span><br><span class="line">    \ <span class="string">&#x27;coc-clangd&#x27;</span>, <span class="string">&#x27;coc-pairs&#x27;</span>, <span class="string">&#x27;coc-git&#x27;</span>, <span class="string">&#x27;coc-go&#x27;</span>, <span class="string">&#x27;coc-rust-analyzer&#x27;</span>]</span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;silent&gt;</span><span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;cr&gt;</span> <span class="built_in">pumvisible</span>() ? coc#_select_confirm() : <span class="string">&quot;\&lt;C-g&gt;u\&lt;CR&gt;&quot;</span></span><br><span class="line"><span class="comment">&quot; &lt;&lt;&lt; config for coc &lt;&lt;&lt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="node安装"><a href="#node安装" class="headerlink" title="node安装"></a>node安装</h3><p>官方源中版本过低，很多软件都要求更高版本的node，建议使用<a target="_blank" rel="noopener" href="https://github.com/nodesource/distributions.git">nodesource</a>维护的软件源安装，具体参考<a target="_blank" rel="noopener" href="https://github.com/nodesource/distributions.git">项目主页</a>。写此文时，安装长期维护版node的具体命令为：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Using Ubuntu</span></span><br><span class="line">curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -</span><br><span class="line">sudo apt-get install -y nodejs</span><br></pre></td></tr></table></figure></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lpypl.top/2021/07/02/%E5%88%A9%E7%94%A8%E5%BF%AB%E9%80%9F%E5%B9%82%E6%A8%A1%E8%BF%90%E7%AE%97%E5%8A%A0%E9%80%9FRSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
      <meta itemprop="name" content="Liu Peiyuan">
      <meta itemprop="description" content="刘沛源的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/02/%E5%88%A9%E7%94%A8%E5%BF%AB%E9%80%9F%E5%B9%82%E6%A8%A1%E8%BF%90%E7%AE%97%E5%8A%A0%E9%80%9FRSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">利用快速幂模运算加速RSA加密解密过程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-03 06:42:00" itemprop="dateCreated datePublished" datetime="2021-07-03T06:42:00+08:00">2021-07-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-22 00:27:23" itemprop="dateModified" datetime="2025-09-22T00:27:23+08:00">2025-09-22</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/07/02/%E5%88%A9%E7%94%A8%E5%BF%AB%E9%80%9F%E5%B9%82%E6%A8%A1%E8%BF%90%E7%AE%97%E5%8A%A0%E9%80%9FRSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E8%BF%87%E7%A8%8B/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/07/02/利用快速幂模运算加速RSA加密解密过程/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>829</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>之前实现RSA加密算法时，计算幂成了程序的瓶颈，前段时间了解了快速幂以及快速幂模运算，这种算法可以用于加速RSA加密解密过程中的幂模计算过程。</p>
<h2 id="快速幂"><a href="#快速幂" class="headerlink" title="快速幂"></a>快速幂</h2><h3 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h3><p>  用精确的数学符号表示的话，有下面两种写法：  </p>
  
  $$ a ^ b = {\begin{cases}(a ^ {\frac b 2}) ^ 2, &if\ b\ is\ even\\a \cdot (a ^ {\frac {b-1} 2}) ^ 2, &if\ b\ is\ odd\end{cases}}$$
  
<p>  或</p>
  
  $$ a ^ b = {\begin{cases}(a ^ {\lfloor {\frac b 2} \rfloor}) ^ 2, &if\ b\ is\ even\\a \cdot (a ^ {\lfloor {\frac b 2} \rfloor}) ^ 2, &if\ b\ is\ odd\end{cases}}$$
  
<p>  上述公式显然成立，故计算幂可用上述递推式进行。</p>
<p>  而在编程语言中，整除一般就相当于向下取整，故上述递推式可以表示成下面的伪代码：<br>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func pow(a, b):</span><br><span class="line">  if b is 0:</span><br><span class="line">    return 1</span><br><span class="line">  if b is even:</span><br><span class="line">    return pow(a, b/2) ^ 2</span><br><span class="line">  if b is odd:</span><br><span class="line">    return pow(a, b/2) ^ 2 * a</span><br></pre></td></tr></table></figure></p>
<h3 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><p>  对于 $a^b$，用原始的求幂算法，需要计算 $b$ 次乘法，用上述递推式大约需要运算 $log\ b$ 次</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>下面的代码实现了朴素求幂算法和快速幂算法，并对比了他们的运算时间。  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc_time</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner_func</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        func(*args, **kwargs)</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Time used: <span class="subst">&#123;end_time - start_time&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> inner_func</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@calc_time</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prime_pow</span>(<span class="params">base, power</span>):</span><br><span class="line">    res = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(power):</span><br><span class="line">        res *= base</span><br><span class="line">    <span class="comment"># print(f&#x27;The last five digits of the result &#123;base&#125; ^ &#123;power&#125;: &#123;str(res)[-5:]&#125;&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quick_pow</span>(<span class="params">base, power</span>):</span><br><span class="line">    <span class="keyword">if</span> power == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    res = quick_pow(base, power // <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> power % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> res * res</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> res * res * base</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@calc_time</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quick_pow_wrapper</span>(<span class="params">base, power</span>):</span><br><span class="line">    res = quick_pow(base, power)</span><br><span class="line">    <span class="comment"># print(f&#x27;The last five digits of the result of &#123;base&#125; ^ &#123;power&#125;: &#123;str(res)[-5:]&#125;&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">prime_pow(<span class="number">2</span>, <span class="number">1000000</span>) <span class="comment"># Time used: 15.331219911575317</span></span><br><span class="line">quick_pow_wrapper(<span class="number">2</span>, <span class="number">1000000</span>) <span class="comment"># Time used: 0.003216981887817383</span></span><br><span class="line">quick_pow_wrapper(<span class="number">13789</span>, <span class="number">722341</span>) <span class="comment"># Time used: 0.003216981887817383</span></span><br><span class="line">prime_pow(<span class="number">13789</span>, <span class="number">722341</span>) <span class="comment"># long long long long no result</span></span><br></pre></td></tr></table></figure>
<h2 id="快速幂模"><a href="#快速幂模" class="headerlink" title="快速幂模"></a>快速幂模</h2><h3 id="基本原理-1"><a href="#基本原理-1" class="headerlink" title="基本原理"></a>基本原理</h3><p>求模运算有这样一条性质: <script type="math/tex">(a * b) \% m = (a \% m * b \% m) \% m</script></p>
<p>利用这一性质，结合快速幂递推式可得：</p>
  
  $$ a ^ b \% m = {\begin{cases}(a ^ {\lfloor {\frac b 2} \rfloor} \% m) ^ 2 \%m, &if\ b\ is\ even\\(a \%m \cdot (a ^ {\lfloor {\frac b 2} \rfloor} \%m) ^ 2) \%m, &if\ b\ is\ odd\end{cases}}$$
  
<p>表示成伪代码如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func pow_mod(a, b, m):</span><br><span class="line">  if b is 0:</span><br><span class="line">    return 1</span><br><span class="line">  if b is even:</span><br><span class="line">    return pow_mod(a, b/2, m) ^ 2 % m</span><br><span class="line">  if b is odd:</span><br><span class="line">    return (a % m * pow_mod(a, b/2, m) ^ 2) % m</span><br></pre></td></tr></table></figure>
<h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">pow_mod</span>(<span class="params">a, b, m</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    res = pow_mod(a, b // <span class="number">2</span>, m)</span><br><span class="line">    <span class="keyword">if</span> b % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> res * res % m</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> res * res * (a % m) % m</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pow_mod(<span class="number">2147483647</span>, <span class="number">200</span>, <span class="number">1337</span>))</span><br></pre></td></tr></table></figure>
<h2 id="加速RSA加密解密过程"><a href="#加速RSA加密解密过程" class="headerlink" title="加速RSA加密解密过程"></a>加速RSA加密解密过程</h2><p>RSA加密和解密需要计算大数幂的模，用原始计算方法难以进行，可以用快速幂模运算加速运算过程。</p>
<p>下面的代码是对 <code>2021-05-23-RSA加密算法原理</code> 中RSA密钥生成、加密、解密的DEMO的改进。 </p>
<p>具体代码如下:</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Tuple</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAKey</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">RSAParams</span>:</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, p, q, N, phiN, e, d</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">            self.p = p</span><br><span class="line">            self.q = q</span><br><span class="line">            self.N = N</span><br><span class="line">            self.phiN = phiN</span><br><span class="line">            self.e = e</span><br><span class="line">            self.d = d</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;&quot;&quot;&#123;&#123;</span></span><br><span class="line"><span class="string">  p: <span class="subst">&#123;self.p&#125;</span>\n</span></span><br><span class="line"><span class="string">  q: <span class="subst">&#123;self.q&#125;</span>\n</span></span><br><span class="line"><span class="string">  N: <span class="subst">&#123;self.N&#125;</span>\n</span></span><br><span class="line"><span class="string">  phiN: <span class="subst">&#123;self.phiN&#125;</span>\n</span></span><br><span class="line"><span class="string">  e: <span class="subst">&#123;self.e&#125;</span>\n</span></span><br><span class="line"><span class="string">  d: <span class="subst">&#123;self.d&#125;</span></span></span><br><span class="line"><span class="string">&#125;&#125;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.params = self.__generateRSAParams()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getPublicKey</span>(<span class="params">self</span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;get public key</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            Tuple[int, int]: (N, e)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (self.params.N, self.params.e)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getPrivateKey</span>(<span class="params">self</span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;get private key</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            Tuple[int, int]: (N, d)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (self.params.N, self.params.d)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__generateRSAParams</span>(<span class="params">self</span>) -&gt; RSAParams:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Generate parameters for RSA</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            RSAParams: instance of RSAParams</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 产生两个大素数</span></span><br><span class="line">        <span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line">        p: <span class="built_in">int</span> = number.getPrime(<span class="number">476</span>)</span><br><span class="line">        q: <span class="built_in">int</span> = number.getPrime(<span class="number">476</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># p 与 q 不能相等</span></span><br><span class="line">        <span class="keyword">while</span> q == p:</span><br><span class="line">            q: <span class="built_in">int</span> = number.getPrime(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># N = p x q</span></span><br><span class="line">        N: <span class="built_in">int</span> = p * q</span><br><span class="line"></span><br><span class="line">        <span class="comment"># phi(N)</span></span><br><span class="line">        phiN: <span class="built_in">int</span> = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 取公钥参数 e，e 应小于 phi(N) 且与 phi(N) 互质</span></span><br><span class="line">        <span class="comment"># 一种简单的思路是找到一个质数 e，只要 phi(N) 不是它的倍数即可</span></span><br><span class="line">        e: <span class="built_in">int</span> = number.getPrime(<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">while</span> phiN % e == <span class="number">0</span>:</span><br><span class="line">            e: <span class="built_in">int</span> = number.getPrime(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 使用扩展欧几里得算法求解 e 的模逆元 d</span></span><br><span class="line">        _, d, _ = self.__exgcd(e, phiN)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果计算得到的 d 是负数，则加上 phi(N) 将其转为正数，仍然与 phi(N) 保持同余关系</span></span><br><span class="line">        <span class="keyword">if</span> d &lt; <span class="number">0</span>:</span><br><span class="line">            d = d + phiN</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.RSAParams(p, q, N, phiN, e, d)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exgcd</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;扩展欧几里得算法</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            a (int): a</span></span><br><span class="line"><span class="string">            b (int): b</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            int: (gcd, x, y)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        ri: <span class="built_in">int</span> = a</span><br><span class="line">        rj: <span class="built_in">int</span> = b</span><br><span class="line">        si: <span class="built_in">int</span> = <span class="number">1</span></span><br><span class="line">        sj: <span class="built_in">int</span> = <span class="number">0</span></span><br><span class="line">        ti: <span class="built_in">int</span> = <span class="number">0</span></span><br><span class="line">        tj: <span class="built_in">int</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> rj != <span class="number">0</span>:</span><br><span class="line">            qi = ri // rj</span><br><span class="line"></span><br><span class="line">            rtemp = rj</span><br><span class="line">            rj = ri - qi * rj</span><br><span class="line">            ri = rtemp</span><br><span class="line"></span><br><span class="line">            stemp = sj</span><br><span class="line">            sj = si - qi * sj</span><br><span class="line">            si = stemp</span><br><span class="line"></span><br><span class="line">            ttemp = tj</span><br><span class="line">            tj = ti - qi * tj</span><br><span class="line">            ti = ttemp</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ri, si, ti</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pow_mod</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span>, m: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;fast power module</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        a : a ^ b % m</span></span><br><span class="line"><span class="string">        b : a ^ b % m</span></span><br><span class="line"><span class="string">        m : a ^ b % m</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        int: a ^ b % m</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    res = pow_mod(a, b // <span class="number">2</span>, m)</span><br><span class="line">    <span class="keyword">if</span> b % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> res * res % m</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> res * res * (a % m) % m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, publicKey</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;encrypt message using public key</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        m (int): origin message m</span></span><br><span class="line"><span class="string">        publicKey (Tuple[int, int]): (N, e)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        int: encrypted message c</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    N, e = publicKey</span><br><span class="line">    c = pow_mod(m, e, N)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">c, privateKey</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;decrypt message using private key</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        c (int): encrypted message c</span></span><br><span class="line"><span class="string">        privateKey (Tuple[int, int]): (N, d)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        int: origin message m</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    N, d = privateKey</span><br><span class="line">    <span class="comment"># m = c ** d % N</span></span><br><span class="line">    m = pow_mod(c, d, N)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    rsakey = RSAKey()</span><br><span class="line">    publicKey = rsakey.getPublicKey()</span><br><span class="line">    privateKey = rsakey.getPrivateKey()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;publicKey: <span class="subst">&#123;publicKey&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;privateKey: <span class="subst">&#123;privateKey&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    message = <span class="number">123456789</span></span><br><span class="line">    encryptedMessage = encrypt(message, publicKey)</span><br><span class="line">    decryptedMessage = decrypt(encryptedMessage, privateKey)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;origin message: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;encrypted message: <span class="subst">&#123;encryptedMessage&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;decrypted message: <span class="subst">&#123;decryptedMessage&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lpypl.top/2021/05/23/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
      <meta itemprop="name" content="Liu Peiyuan">
      <meta itemprop="description" content="刘沛源的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/23/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">RSA加密算法原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-23 09:57:00" itemprop="dateCreated datePublished" datetime="2021-05-23T09:57:00+08:00">2021-05-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-22 00:27:23" itemprop="dateModified" datetime="2025-09-22T00:27:23+08:00">2025-09-22</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/05/23/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/05/23/RSA加密算法原理/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>RSA加密算法是一种非对称加密算法。</p>
<h2 id="所需数学知识"><a href="#所需数学知识" class="headerlink" title="所需数学知识"></a>所需数学知识</h2><p>想要完整地理解RSA加密算法，需要了解不少数论知识，下面介绍几点核心内容。</p>
<h3 id="同余"><a href="#同余" class="headerlink" title="同余"></a>同余</h3><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%90%8C%E9%A4%98">同余</a>是数论中的一种等价关系。两个整数 $a$、$b$，若它们除以正整数 $m$ 所得的余数相等，则称 $a$、$b$ 对于模 $m$ 同余，表示为：<br>  
  $$a \equiv b \quad (mod \quad m)$$  
  </p>
<p>同余式有多种性质：  </p>
<ol>
<li><p>整除性  </p>
 
    $$a\equiv b{\pmod {m}}\Rightarrow c\cdot m=a-b,c\in \mathbb {Z}$$  
      
</li>
<li><p>传递性  </p>
 
    $$ \left.{\begin{matrix}a\equiv b{\pmod {m}}\\b\equiv c{\pmod {m}}\end{matrix}}\right\} \Rightarrow a\equiv c{\pmod {m}}$$  
      
</li>
<li><p>保持基本运算</p>
 
    $$\left.{\begin{matrix}a\equiv b{\pmod {m}}\\c\equiv d{\pmod {m}}\end{matrix}}\right\}\Rightarrow \left\{{\begin{matrix}a\pm c\equiv b\pm d{\pmod {m}}\\ac\equiv bd{\pmod {m}}\end{matrix}}\right.$$
    
<p> 当 $c=d$ 时，则为等量加法、减法：$a\pm c\equiv b\pm c{\pmod {m}}$  </p>
<p> 此性质更可进一步引申成：</p>
 
    $$ a\equiv b{\pmod {m}}\Rightarrow {\begin{cases}an\equiv bn{\pmod {m}},\forall n\in \mathbb {Z} \\a^{n}\equiv b^{n}{\pmod {m}},\forall n\in \mathbb {N} ^{0}\end{cases}}$$
    
</li>
<li><p>更多性质见<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%90%8C%E9%A4%98">同余 - 维基百科</a></p>
</li>
</ol>
<h3 id="欧拉定理"><a href="#欧拉定理" class="headerlink" title="欧拉定理"></a>欧拉定理</h3><p>在数论中，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86_(%E6%95%B0%E8%AE%BA">欧拉定理</a>)是一个关于同余的性质。  </p>
<p>若 $n$, $a$ 为正整数，且 $n$, $a$ 互质，即 $gcd(n,a)=1$，则<br>  
  $$a^{\varphi(n)}\equiv1 \quad (mod \quad n)$$  
  <br>其中 $\varphi(n)$ 为<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0">欧拉函数</a>。</p>
<h3 id="欧拉函数"><a href="#欧拉函数" class="headerlink" title="欧拉函数"></a>欧拉函数</h3><p>在数论中，对正整数 $n$，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0">欧拉函数</a> $\varphi (n)$ 是小于或等于 $n$ 的正整数中与 $n$ 互质的数的数目。<br>特别地：  </p>
<ul>
<li>若 $n$ 为质数，则 $\varphi(n) = n - 1$  </li>
<li>若 $n$ 可以表示为两个互质的整数之积，比如 $n=pq$，则 $\varphi(n)=\varphi(p)\varphi(q)$  </li>
<li>若 $n$ 可以表示为两个质数之积，比如 $n=pq$，则 $\varphi(n)=\varphi(p)\varphi(q) = (p-1)(q-1)$  </li>
</ul>
<h3 id="扩展欧几里得算法"><a href="#扩展欧几里得算法" class="headerlink" title="扩展欧几里得算法"></a>扩展欧几里得算法</h3><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95">扩展欧几里得算法</a>是欧几里得算法的扩展。已知整数 $a$、$b$，扩展欧几里得算法在求得 $gcd(a,b)$ 的同时，能找到整数 $x$、$y$，使它们满足<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E7%A5%96%E5%AE%9A%E7%90%86">裴蜀等式</a>：<br>  
  $$ax+by=gcd(a,b)$$  
  </p>
<p>扩展欧几里得算法可用于求解<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E7%A5%96%E5%AE%9A%E7%90%86">裴蜀等式</a>：<br>  
  $$ax+by=m$$ 
   </p>
<p>当且仅当 $m$ 是 $a$ 与 $b$ 的最大公约数的倍数时，该方程有解，且有解时必有无数组解。</p>
<h3 id="模反元素"><a href="#模反元素" class="headerlink" title="模反元素"></a>模反元素</h3><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0">模反元素</a>也称为模倒数，或者模逆元。</p>
<p>一整数 $a$ 对同余 $n$ 之模逆元是指满足以下公式的整数 $b$<br>  
  $$a^{-1}\equiv b{\pmod {n}}$$
  </p>
<p>也可以写成以下的式子<br>  
  $$ab\equiv 1{\pmod  {n}}$$
  </p>
<p>或者<br>  
  $$ab{\pmod n}=1$$
  </p>
<p>由定义可得：<br>  
  $$ab = 1 + kn \Rightarrow ab - kn = 1$$  
  </p>
<p>要求解 $b$，就需要求不定方程 $ax + ny = 1$ 的解，根据<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E7%A5%96%E7%AD%89%E5%BC%8F">裴蜀定理</a>，当且仅当 $1$ 是 $gcd(a, n)$ 的整数倍时，即 $a$ 与 $n$ 互质时，上述方程有解。用扩展欧几里得算法求得的 $x$ 即为模反元素 $b$。</p>
<h2 id="生成密钥"><a href="#生成密钥" class="headerlink" title="生成密钥"></a>生成密钥</h2><p>假设Alice想要通过一个不可靠的媒体接收Bob的一条私人信息。她可以用以下的方式来产生一个公钥和一个私钥：</p>
<ol>
<li>任意选取两个大质数 $p$、$q$，保证 $p \neq q$ ， 计算 $N=pq$  </li>
<li>根据欧拉函数，计算
  $$\begin{equation}\begin{split}
  \varphi(N)&=\varphi(pq)\\\\
  &=\varphi(p)\varphi(q)\\\\
  &=(p-1)(q-1)\end{split}\end{equation}$$  
  </li>
<li>选择一个小于 $\varphi(N)$ 的整数 $e$，使 $e$ 与 $\varphi(N)$ 互质，并求得 $e$ 关于 $\varphi(N)$ 的模逆元，称为 $d$。<br>由模逆元的定义可得： $ed \equiv 1 {\pmod {\varphi(N)}}$<br>则有 $ed + h\varphi(N) = 1$<br>已知 $e$ 与 $\varphi(N)$ 互质，根据裴蜀定理知该不定方程有解，利用扩展欧几里得算法即可求得 $e$ 的模逆元 $d$  </li>
<li>销毁 $p$、$q$、$\varphi(N)$  </li>
</ol>
<p>Alice将她的公钥 $(N,e)$ 传给Bob，而将她的私钥 $(N,d)$ 藏起来。</p>
<h2 id="加密与解密"><a href="#加密与解密" class="headerlink" title="加密与解密"></a>加密与解密</h2><h3 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h3><p>假设Bob想给Alice送一个消息，他知道Alice产生的 $N$ 和 $e$。他使用起先与Alice约好的格式将消息转换为一个小于 $N$ 的非负整数 $m$，比如他可以将每一个字转换为这个字的Unicode码，然后将这些数字连在一起组成一个数字。假如他的信息非常长的话，他可以将这个信息分为几段，然后将每一段转换为 $m$。用下面这个公式他可以将 $m$ 加密为 $c$：<br>
$$ c\equiv m^e {\pmod N}$$
</p>
<p>计算 $c$ 并不复杂。Bob算出 $c$ 后就可以将它传递给Alice。</p>
<h3 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h3><p>Alice得到Bob的消息 $c$ 后就可以利用她的密钥 $N$ 和 $d$ 来解码。她可以用以下这个公式来将 $c$ 转换为 $m$：<br>
$$m \equiv c^d {\pmod N}$$
</p>
<p>得到 $m$ 后，她可以将原来的信息重新复原。</p>
<h3 id="解密原理"><a href="#解密原理" class="headerlink" title="解密原理"></a>解密原理</h3><p>根据加密公式可得：  </p>

$$\begin{equation}\begin{split}
&c \equiv m^e {\pmod N} \Rightarrow\\\\
&(c)^d \equiv (m^e)^d {\pmod N} \Rightarrow\\\\
&c^d \equiv m^{ed} {\pmod N}\\\\
\end{split}\end{equation}$$

<p>只要能证明下面的式子，就说明解密公式是正确的：</p>

$$\begin{equation}
c^d \equiv m^{ed} \equiv m {\pmod N}
\end{equation}$$

<p><strong>证明</strong>：<br>根据密钥推导过程，可知 $ed = 1 + h\varphi(N) $，则<br>
$$m^{ed} = m^{1+h\varphi(N)} = (m^{\varphi(N)})^h  m$$
</p>
<p>若明文 $m$ 与 $N$ 互质，根据欧拉定理可得：  </p>

$$\begin{equation}\begin{split}
&m^{\varphi(N)} \equiv 1 {\pmod N} \Rightarrow\\\\
&(m^{\varphi(N)})^h \equiv (1)^h {\pmod N} \Rightarrow\\\\
&(m^{\varphi(N)})^hm \equiv (1)^hm {\pmod N} \Rightarrow\\\\
&m^{ed} \equiv m {\pmod N} \Rightarrow\\\\
&c^{d} \equiv m {\pmod N}\\\\
\end{split}\end{equation}$$

<p>若明文 $m$ 与 $N$ 不互质，由于 $N=pq$，且$p$、$q$均为质数，而 $0 &lt; m &lt; N$，故 $m=kp$ 或 $m=kq$，下面以 $m=kp$ 为例展开证明：</p>
<p>如果 $m=kp$，则 $m$ 不会是 $q$ 的倍数，否则 $m$ 就会大于等于 $N$，违反了前提条件，而 $q$ 又是质数，故 $m$ 与 $q$ 互质，根据欧拉定理可得：<br>
$$\begin{equation}\begin{split}
&m^{\varphi(q)} \equiv 1 {\pmod q} \Rightarrow\\\\
&(m^{\varphi(q)})^{\varphi(p)} \equiv (1)^{\varphi(p)} {\pmod q} \Rightarrow\\\\
&m^{\varphi(q)\varphi(p)} \equiv 1 {\pmod q} \Rightarrow\\\\
&m^{\varphi(N)} \equiv 1 {\pmod q} \Rightarrow\\\\
&m^{h\varphi(N)} \equiv 1 {\pmod q} \Rightarrow\\\\
&m^{1+h\varphi(N)} \equiv m {\pmod q} \Rightarrow\\\\
&(kp)^{1+h\varphi(N)} \equiv kp {\pmod q} \Rightarrow\\\\
\end{split}\end{equation}$$
</p>
<p>由上式可得：</p>

$$\begin{equation}\begin{split}
&kp(kp)^{h\varphi(N)} = kp + tq\\\\
\end{split}\end{equation}$$

<p>由于$p$ 与 $q$ 互质，要使该式成立，须有 $t=t’p$，代入上式可得：</p>

$$\begin{equation}\begin{split}
&(kp)^{1+h\varphi(N)} = kp + t‘qp \Rightarrow\\\\
&(kp)^{1+h\varphi(N)} = kp + t‘N \Rightarrow\\\\
&m^{1+h\varphi(N)} = m + t‘N \Rightarrow\\\\
&m^{1+h\varphi(N)} \equiv m {\pmod N} \Rightarrow
\end{split}\end{equation}$$

<p>结合 $m^{ed} = m^{1+h\varphi(N)} = (m^{\varphi(N)})^h  m$ 可得：</p>

$$\begin{equation}\begin{split}
&c^d \equiv m^{ed} \equiv m^{1+h\varphi(N)} \equiv m {\pmod N}
\end{split}\end{equation}$$

<h2 id="签名与验证"><a href="#签名与验证" class="headerlink" title="签名与验证"></a>签名与验证</h2><p>见<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/RSA%E5%8A%A0%E5%AF%86%E6%BC%94%E7%AE%97%E6%B3%95">RSA加密算法 - 维基百科</a>。</p>
<p>基本原理与加密、解密基本一致，只是用私钥加密，用公钥解密。</p>
<h2 id="算法安全性"><a href="#算法安全性" class="headerlink" title="算法安全性"></a>算法安全性</h2><p>假设偷听者Eve获得了Alice的公钥 $n$ 和 $e$ 以及Bob的加密消息 $c$，但她无法直接获得Alice的密钥 $d$。要获得 $d$，最简单的方法是将 $n$ 分解为 $p$ 和 $q$，这样她可以得到同余方程 $ed\equiv 1{\pmod{(p-1)(q-1)}}$并解出 $d$，然后代入解密公式<br>  
  $$c^{d}\equiv m\ (\mathrm {mod} \ n)$$
  </p>
<p>导出m（破密）。但至今为止还没有人找到一个多项式时间的算法来分解一个大的整数的因子，同时也还没有人能够证明这种算法不存在（见因数分解）。  </p>
<p>至今为止也没有人能够证明对 $n$ 进行因数分解是唯一的从 $c$ 导出 $n$ 的方法，直到今天也还没有找到比它更简单的方法。（至少没有公开的方法。）</p>
<p>因此今天一般认为只要 $n$ 足够大，那么黑客就没有办法了。</p>
<p>假如 $n$ 的长度小于或等于256位，那么用一台个人电脑在几个小时内就可以分解它的因子了。1999年，数百台电脑合作分解了一个512位长的 $n$。一个由Shamir 和Tromer在2003年从理论上构建的硬件TWIRL，使人们开始质疑1024位长的 $n$ 的安全性，目前推荐 $n$ 的长度至少为2048位。</p>
<p>1994年彼得·秀尔（Peter Shor）证明一台量子计算机可以在多项式时间内进行因数分解。假如量子计算机有朝一日可以成为一种可行的技术的话，那么秀尔的算法可以淘汰RSA和相关的派生算法。（即依赖于分解大整数困难性的加密算法）</p>
<p>假如有人能够找到一种有效的分解大整数的算法的话，或者假如量子计算机可行的话，那么在解密和制造更长的钥匙之间就会展开一场竞争。但从原理上来说RSA在这种情况下是不可靠的。  </p>
<h2 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h2><p>下面的代码根据上述原理实现了一个简单版本的RSA密钥生成、加密、解密的DEMO。 </p>
<p>本以为应该不难实现，结果发现大质数的生成本身就是问题，除此之外还有其它的一些问题。关键问题以及大致思路：</p>
<ol>
<li><p>质数的生成，经过查阅资料，得知大致方法是随机选取大整数，并通过一些方法判断它是不是质数，然而暴力的方法复杂度极高，目前有几种比较有效的质数判定方法，在此不再赘述，可自行查阅相关资料。下列程序当中使用了 <code>Crypto</code> 模块的素数生成功能。  </p>
</li>
<li><p>公钥参数 $e$ 的生成， $e$ 需要与 $\varphi(N)$ 互质，一种简单的思路是选取一个质数 $e$，只要 $\phi(N)$ 不是它的整数倍即可。</p>
</li>
</ol>
<p>具体代码如下:</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Tuple</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAKey</span>:</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">RSAParams</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, p, q, N, phiN, e, d</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.p = p</span><br><span class="line">        self.q = q</span><br><span class="line">        self.N = N</span><br><span class="line">        self.phiN = phiN</span><br><span class="line">        self.e = e</span><br><span class="line">        self.d = d</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;&quot;&quot;&#123;&#123;</span></span><br><span class="line"><span class="string">  p: <span class="subst">&#123;self.p&#125;</span>\n</span></span><br><span class="line"><span class="string">  q: <span class="subst">&#123;self.q&#125;</span>\n</span></span><br><span class="line"><span class="string">  N: <span class="subst">&#123;self.N&#125;</span>\n</span></span><br><span class="line"><span class="string">  phiN: <span class="subst">&#123;self.phiN&#125;</span>\n</span></span><br><span class="line"><span class="string">  e: <span class="subst">&#123;self.e&#125;</span>\n</span></span><br><span class="line"><span class="string">  d: <span class="subst">&#123;self.d&#125;</span></span></span><br><span class="line"><span class="string">&#125;&#125;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    self.params = self.__generateRSAParams()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">getPublicKey</span>(<span class="params">self</span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;get public key</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        Tuple[int, int]: (N, e)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (self.params.N, self.params.e)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">getPrivateKey</span>(<span class="params">self</span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;get private key</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        Tuple[int, int]: (N, d)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (self.params.N, self.params.d)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__generateRSAParams</span>(<span class="params">self</span>) -&gt; RSAParams:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Generate parameters for RSA</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        RSAParams: instance of RSAParams</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 产生两个大素数</span></span><br><span class="line">    <span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line">    p : <span class="built_in">int</span> = number.getPrime(<span class="number">10</span>)</span><br><span class="line">    q : <span class="built_in">int</span> = number.getPrime(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># p 与 q 不能相等</span></span><br><span class="line">    <span class="keyword">while</span> q == p:</span><br><span class="line">      q : <span class="built_in">int</span> = number.getPrime(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># N = p x q</span></span><br><span class="line">    N : <span class="built_in">int</span> = p * q</span><br><span class="line"></span><br><span class="line">    <span class="comment"># phi(N)</span></span><br><span class="line">    phiN : <span class="built_in">int</span> = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 取公钥参数 e，e 应小于 phi(N) 且与 phi(N) 互质</span></span><br><span class="line">    <span class="comment"># 一种简单的思路是找到一个质数 e，只要 phi(N) 不是它的倍数即可</span></span><br><span class="line">    e : <span class="built_in">int</span> = number.getPrime(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">while</span> phiN % e == <span class="number">0</span>:</span><br><span class="line">      e : <span class="built_in">int</span> = number.getPrime(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用扩展欧几里得算法求解 e 的模逆元 d</span></span><br><span class="line">    _, d, _ = self.__exgcd(e, phiN)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果计算得到的 d 是负数，则加上 phi(N) 将其转为正数，仍然与 phi(N) 保持同余关系 </span></span><br><span class="line">    <span class="keyword">if</span> d &lt; <span class="number">0</span>:</span><br><span class="line">      d = d + phiN</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> self.RSAParams(p, q, N, phiN, e, d)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__exgcd</span>(<span class="params">self, a, b</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;扩展欧几里得算法</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        a (int): a</span></span><br><span class="line"><span class="string">        b (int): b</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        int: (gcd, x, y)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    ri :<span class="built_in">int</span> = a</span><br><span class="line">    rj :<span class="built_in">int</span> = b</span><br><span class="line">    si :<span class="built_in">int</span> = <span class="number">1</span></span><br><span class="line">    sj :<span class="built_in">int</span> = <span class="number">0</span></span><br><span class="line">    ti :<span class="built_in">int</span> = <span class="number">0</span></span><br><span class="line">    tj :<span class="built_in">int</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> rj != <span class="number">0</span>:</span><br><span class="line">      qi = ri // rj</span><br><span class="line"></span><br><span class="line">      rtemp = rj</span><br><span class="line">      rj = ri - qi * rj</span><br><span class="line">      ri = rtemp</span><br><span class="line"></span><br><span class="line">      stemp = sj</span><br><span class="line">      sj = si - qi * sj</span><br><span class="line">      si = stemp</span><br><span class="line"></span><br><span class="line">      ttemp = tj</span><br><span class="line">      tj = ti - qi * tj</span><br><span class="line">      ti = ttemp</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ri, si, ti</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m, publicKey</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">  <span class="string">&quot;&quot;&quot;encrypt message using public key</span></span><br><span class="line"><span class="string">  Args:</span></span><br><span class="line"><span class="string">      m (int): origin message m</span></span><br><span class="line"><span class="string">      publicKey (Tuple[int, int]): (N, e)</span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">      int: encrypted message c</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">  N, e = publicKey</span><br><span class="line">  c = m ** e % N</span><br><span class="line">  <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">c, privateKey</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">  <span class="string">&quot;&quot;&quot;decrypt message using private key</span></span><br><span class="line"><span class="string">  Args:</span></span><br><span class="line"><span class="string">      c (int): encrypted message c</span></span><br><span class="line"><span class="string">      privateKey (Tuple[int, int]): (N, d)</span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">      int: origin message m</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">  N, d = privateKey</span><br><span class="line">  m = c ** d % N</span><br><span class="line">  <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">  rsakey = RSAKey()</span><br><span class="line">  publicKey = rsakey.getPublicKey()</span><br><span class="line">  privateKey = rsakey.getPrivateKey()</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;publicKey: <span class="subst">&#123;publicKey&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;privateKey: <span class="subst">&#123;privateKey&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">  message = <span class="number">12345</span></span><br><span class="line">  encryptedMessage = encrypt(message, publicKey)</span><br><span class="line">  decryptedMessage = decrypt(encryptedMessage, privateKey)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;origin message: <span class="subst">&#123;message&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;encrypted message: <span class="subst">&#123;encryptedMessage&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;decrypted message: <span class="subst">&#123;decryptedMessage&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95">扩展欧几里得算法 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%90%8C%E9%A4%98">同余 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86_(%E6%95%B0%E8%AE%BA">欧拉定理 - 维基百科</a>)<br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0">欧拉函数 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0">模反元素 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/RSA%E5%8A%A0%E5%AF%86%E6%BC%94%E7%AE%97%E6%B3%95">RSA加密算法 - 维基百科</a><br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">阮一峰：RSA算法原理（一）</a><br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html">阮一峰：RSA算法原理（二）</a><br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html">阮一峰：数字签名是什么？</a><br><a target="_blank" rel="noopener" href="https://cnodejs.org/topic/5bb9c31e15e4fd1923f48d0b">RSA算法的数学原理与证明</a>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lpypl.top/2021/05/21/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
      <meta itemprop="name" content="Liu Peiyuan">
      <meta itemprop="description" content="刘沛源的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/21/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">扩展欧几里得算法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-22 06:29:00" itemprop="dateCreated datePublished" datetime="2021-05-22T06:29:00+08:00">2021-05-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-22 00:27:23" itemprop="dateModified" datetime="2025-09-22T00:27:23+08:00">2025-09-22</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/05/21/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/05/21/扩展欧几里得算法/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>上一篇文章简单介绍了欧几里得算法，即辗转相除法，它可以用于求解任意两个自然数 $a$ 和 $b$ 的最大公约数。而扩展欧几里得算法在求得 $gcd(a.b)$ 的同时，也能找到整数 $x$ 和 $y$ ,使它们满足裴蜀等式：<br>  
  $$ax+by=gcd(a,b)$$
  </p>
<h2 id="裴蜀定理"><a href="#裴蜀定理" class="headerlink" title="裴蜀定理"></a>裴蜀定理</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>在数论中，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E7%A5%96%E7%AD%89%E5%BC%8F">裴蜀定理</a>是一个关于最大公约数的定理。</p>
<blockquote>
<p>对任意两个整数 $a$、$b$，设 $g=gcd(a,b)$ 是它们的最大公约数。那么关于未知数 $x$ 和 $y$ 的线性<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%B8%9F%E7%95%AA%E5%9C%96%E6%96%B9%E7%A8%8B">裴蜀等式</a>：<br>  
  $$ax+by=m$$
  <br> 有整数解 $(x, y)$ 当且仅当 $m$ 是 $g$ 的整数倍。</p>
</blockquote>
<p>裴蜀等式有解时必然有无穷多个解，每组解 $(x,y)$ 都称为裴蜀数。</p>
<h3 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h3><p>参考<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E7%A5%96%E7%AD%89%E5%BC%8F">裴蜀定理 - 维基百科</a>  </p>
<blockquote>
<p>维基百科中证明步骤的大概思路是这样的：<br>(1) 给出集合 $A = {ax+by|(x,y)\in\mathbb{Z}^2}$<br>(2) 通过$A\cap\mathbb{N}^*\neq\emptyset$，$\mathbb{N}$良序等讨论，指出$A$中必然存在最小正元素$d_0=ax_0+by_0$  </p>
<blockquote>
<p>基本逻辑是这样的，<script type="math/tex">A\cap\mathbb{N}^*</script>中包含了$A$中所有的正元素，且$A\cap\mathbb{N}^*$是良序集合自然数集合$\mathbb{N}$的非空子集，故其中存在最小元素。也就是说集合$A$中存在最小正元素，记为$d_0$。  </p>
</blockquote>
<p>(3) 假设$p=ax+by$为$A$中任何一个正整数，试图计算$p$对$d_0$的带模除法，记为$p=qd_0+r$，因为$d_0$是$A$中最小正整数，故另一正整数$p$必然满足$p \geq d_0$，故$q &gt; 0$，$0\leq r &lt; d_0$<br>(4) 可得$r=p-qd_0=ax+by-q(ax_0+by_0)=a(x-qx_0)+b(y-qy_0)$，根据其形式可判断$r\in A$，结合上一条的结论$0\leq r &lt; d_0$，且$d_0$是$A$中的最小正元素，可推断$r=0$，则可知$A$中任意正整数$p$都满足$p=qd_0$，即$A$中任意正整数$p$都是$d_0$的整数倍，记为$d_0|p$，并且显然$a \in A,b \in A$，故$d_0|a$，$d_0|b$，于是可知$d_0$是$a$和$b$的公约数</p>
<blockquote>
<p>只能判断是公约数，结合后面的证明才得出最大公约数的结论，并且，上面的论述没有仔细考虑$a$，$b$为负值的情况，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E7%A5%96%E7%AD%89%E5%BC%8F">裴蜀定理 - 维基百科</a>的证明也许适用于负数  </p>
</blockquote>
<p>(5) 设$a$与$b$的任意公约数为$d$，则$a$与$b$可表示为$a=kd$，$b=ld$，那么$d_0=ax_0+by_0=kdx_0+ldy_0=(kx_0+ly_0)d$，可知$d|d_0$，也就是说$d_0$是任何$a$和$b$的公约数$d$的倍数，最大公约数也不例外，且由上一点可知$d_0$是$a$和$b$的公约数，由此可推断$d_0$本身就是$a$与$b$的最大公约数<br>(6) 关于解的数量无限的讨论，详见<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E7%A5%96%E7%AD%89%E5%BC%8F">裴蜀定理 - 维基百科</a><br>(7) 总之，从上面的讨论可以得出如下结论：在集合$A = {ax+by|(x,y)\in\mathbb{Z}^2}$当中，最小正元素$d_0=gcd(a,b)$，且$A$中任意正元素都是$d_0$的倍数<br>(8) 因此如果$ax+by=m$有整数解，显然$m \in A$，根据上面的讨论可知 $gcd(a,b)|m$，即$m$是$gcd(a,b)$的整数倍</p>
</blockquote>
<h2 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h2><p>相比欧几里得算法，扩展欧几里得算法在计算余数($q_i$)和商($r_i$)的基础上又增加了两列数据：$s_i$和$t_i$，最终得到的$s_i$和$t_i$满足裴蜀等式：<br>  
  $$as_i+bt_i=r_i=gcd(a,b)$$
  </p>
<p>具体算法步骤如下:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">余数$r_i$</th>
<th style="text-align:center">$s_i$</th>
<th style="text-align:center">$t_i$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$a$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$0$</td>
</tr>
<tr>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$b$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$\vdots$</td>
<td style="text-align:center">$\vdots$</td>
<td style="text-align:center">$\vdots$</td>
<td style="text-align:center">$\vdots$</td>
</tr>
<tr>
<td style="text-align:center">$i+1$</td>
<td style="text-align:center">$r<em>{i+1}=r</em>{i-1}-q_ir_i$</td>
<td style="text-align:center">$s<em>{i+1}=s</em>{i-1}-q_is_i$</td>
<td style="text-align:center">$t<em>{i+1}=t</em>{i-1}-q_it_i$</td>
</tr>
</tbody>
</table>
</div>
<p>终止条件与欧几里得算法相同，当$r_{i+1}=0$时终止，此时：<br>  
  $$as_i+bt_i=r_i=gcd(a,b)$$
  </p>
<h2 id="证明-1"><a href="#证明-1" class="headerlink" title="证明"></a>证明</h2><p>上一篇文章证明了欧几里得算法的正确性，在此基础上说明扩展欧几里得算法的正确性。  </p>
<p>当$i=0$时，$r_0=a,s_0=1,t_i=0$，显然满足$as_i+bt_i=r_i$<br>当$i=1$时，$r_1=b,s_0=0,t_i=1$，显然满足$as_i+bt_i=r_i$<br>由下列递推式可推及所有$i&gt;1$时的情况：<br>  
  $$\begin{equation}\begin{split}
  r_{i+1}&=r_{i-1}-q_ir_i\\\\
  &=(as_{i-1}+bt_{i-1})-q_i(as_i+bt_i)\\\\
  &=a(s_{i-1}-q_is_i)-b(t_{i-1}-q_it_i)\\\\
  &=as_{i+1}+bt_{i+1} 
  \end{split}\end{equation}$$  
    </p>
<p>因此当$r_{i+1}=0$，算法终止时：<br>
$$as_i+bt_i=r_i=gcd(a,b)$$
</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95">扩展欧几里得算法 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%BC%BE%E8%BD%89%E7%9B%B8%E9%99%A4%E6%B3%95">辗转相除法 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B2%9D%E7%A5%96%E7%AD%89%E5%BC%8F">裴蜀定理 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%B8%9F%E7%95%AA%E5%9C%96%E6%96%B9%E7%A8%8B">丢番图方程 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%85%83%E5%85%B3%E7%B3%BB">二元关系 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%81%8F%E5%BA%8F%E5%85%B3%E7%B3%BB">偏序关系 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%85%A8%E5%BA%8F%E5%85%B3%E7%B3%BB">全序关系 - 维基百科</a><br><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%89%AF%E5%BA%8F%E5%85%B3%E7%B3%BB">良序关系 - 维基百科</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lpypl.top/2021/05/21/%E8%BE%97%E8%BD%AC%E7%9B%B8%E9%99%A4%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
      <meta itemprop="name" content="Liu Peiyuan">
      <meta itemprop="description" content="刘沛源的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/21/%E8%BE%97%E8%BD%AC%E7%9B%B8%E9%99%A4%E6%B3%95/" class="post-title-link" itemprop="url">辗转相除法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-21 14:00:00" itemprop="dateCreated datePublished" datetime="2021-05-21T14:00:00+08:00">2021-05-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-22 00:27:23" itemprop="dateModified" datetime="2025-09-22T00:27:23+08:00">2025-09-22</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/05/21/%E8%BE%97%E8%BD%AC%E7%9B%B8%E9%99%A4%E6%B3%95/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/05/21/辗转相除法/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>辗转相除法，又称欧几里得算法，用于系统性地求两个自然数的最大公约数。</p>
<h2 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h2><p>对于任意两个正整数 $a$ 和 $b$ ，求 $a$ 和 $b$ 的最大公约数 $gcd(a, b)$，等价于求解 $gcd(b, a \% b)$，相关资料一般会限定 $a \geq b$，但其实即使 $a &lt; b$ 也无妨，在这种情况下，第一步计算相当于交换 $a$ 和 $b$ 的位置。</p>
<h2 id="证明该算法所需知识"><a href="#证明该算法所需知识" class="headerlink" title="证明该算法所需知识"></a>证明该算法所需知识</h2><p>下文的论证会用到三种相关的数学方法，分别是数学归纳法、递归和无穷递降。</p>
<h3 id="归纳"><a href="#归纳" class="headerlink" title="归纳"></a>归纳</h3><p>数学归纳法经常用来证明某个定理对所有自然数成立：首先证明定理对一个特定的数n0成立（通常是1）；然后证明如果定理对自然数n成立的话，那么它对自然数n + 1成立。这样，便可证明定理对所有大于n0的自然数也成立。</p>
<h3 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h3><p>递归是将相关的数组成一个数列$(a1, a2, a3…)$，当中除初始项外，其中每一项都用前一项或前几项表示。如斐波那契数列就是递归的，每一项$F<em>n$都等于$F</em>{n−1} + F_{n−2}（n\geq2）$。辗转相除法中的一些等式也是递归的。</p>
<h3 id="无穷递降"><a href="#无穷递降" class="headerlink" title="无穷递降"></a>无穷递降</h3><p>最后，无穷递降是用方程的一个自然数解导出比它小的自然数解。但是，这种转化不能永远进行下去，因为只有有限个小于原来的自然数解的自然数。所以，要么方程无解，不然在有限步内必然能得出最小的自然数解。在下文会用到此法来证明辗转相除法一定会在有限步内结束。</p>
<h2 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h2><p>下面以非负整数为例说明如何算法步骤，每一次计算的输入都是前两次计算的非负余数 $r<em>{k-1}$和$r</em>{k-2}$，记$a=r<em>{-2}$，$b=r</em>{-1}$，按如下步骤递归计算  </p>
<blockquote>
<p>$a = p<em>0b + r_0$<br>$b = p_0r_0 + r_1$<br>$r_0 = p_0r_1 + r_2$<br>$r_1 = p_0r_2 + r_3$<br>…<br>$r</em>{k-2} = p<em>0r</em>{k-1} + r_k$  </p>
</blockquote>
<p>按照该算法进行计算，$r_k$必然会逐渐减小，并且由于$[0,r_0]$之间数字有限，该算法必然能够在第$N$步终止。</p>
<p>此时$r<em>N$为0，$r</em>{N-1}$即为$gcd(a,b)$</p>
<h2 id="证明上述算法的正确性"><a href="#证明上述算法的正确性" class="headerlink" title="证明上述算法的正确性"></a>证明上述算法的正确性</h2><p>辗转相除法的正确性可以分成两步来证明。在第一步，我们会证明算法的最终结果$r<em>{N-1}$同时整除$a$和$b$。因为它是一个公约数，所以必然小于或者等于最大公约数$g$。在第二步，我们证明$g$能整除$r</em>{N-1}$。所以g一定小于或等于$r<em>{N-1}$。两个不等式只在$r</em>{N-1}=g$时同时成立。具体证明如下：</p>
<h3 id="1-r-N-1-能整除-a-和-b"><a href="#1-r-N-1-能整除-a-和-b" class="headerlink" title="(1) $r_{N-1}$能整除$a$和$b$"></a>(1) $r_{N-1}$能整除$a$和$b$</h3><p>在算法终止时，余数$r<em>N=0$。则有：$r</em>{N-2} = p<em>0r</em>{N-1}$<br>说明$r<em>{N-1}$能整除$r</em>{N-2}$，又根据$r<em>{N-3} = p_0r</em>{N-2} + r<em>{N-1}$<br>可推断$r</em>{N-1}$能整除$r<em>{N-3}$，以此类推，最终可推断：<br>**$r</em>{N-1}$能整除$a$和$b$<strong>，说明 </strong>$r<em>{N-1}$是$a$和$b$的一个公约数**，且由于$g$是最大公约数，应有$r</em>{N-1} \leq g$</p>
<h3 id="2-g-能整除-r-N-1"><a href="#2-g-能整除-r-N-1" class="headerlink" title="(2) $g$能整除$r_{N-1}$"></a>(2) $g$能整除$r_{N-1}$</h3><p>根据定义，$g$是$a$和$b$的最大公约数，则$g$能整除$a$和$b$，$a$和$b$可表示为$a=mg$，$b=ng$<br>由$r<em>0=a-p_0b=mg-p_0ng=(m-p_0n)g$，可知$g|r_0$，即$g$能整除$r_0$,<br>由$r_1=b-p_0r_0$，$g|r_0$，$g|b$，可得$g|r_1$,<br>依此类推，最终可得$g|r</em>{N-1}$，则$g \leq r_{N-1}$</p>
<p>综合(1)(2)，可知$g=r_{N-1}$</p>
<h2 id="算法优化"><a href="#算法优化" class="headerlink" title="算法优化"></a>算法优化</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/31824895">漫画算法：辗转相除法是什么鬼？ - 知乎</a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%BC%BE%E8%BD%89%E7%9B%B8%E9%99%A4%E6%B3%95">辗转相除法 - 维基百科</a>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lpypl.top/2021/05/20/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
      <meta itemprop="name" content="Liu Peiyuan">
      <meta itemprop="description" content="刘沛源的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/20/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">RSA加密算法阅读笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-20 14:00:00" itemprop="dateCreated datePublished" datetime="2021-05-20T14:00:00+08:00">2021-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-22 00:27:23" itemprop="dateModified" datetime="2025-09-22T00:27:23+08:00">2025-09-22</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/05/20/RSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/05/20/RSA加密算法阅读笔记/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近读到了阮一峰介绍的的<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">RSA算法原理</a>，本文作为对这篇文章的简单批注。</p>
<h2 id="一、非对称加密算法"><a href="#一、非对称加密算法" class="headerlink" title="一、非对称加密算法"></a>一、非对称加密算法</h2><p>对称加密算法的加密与解密过程采用相同的密钥，在这种情况下，往往需要传输密钥，一旦密钥被拦截，就会暴露所传递的信息。</p>
<p>非对称加密算法包含一对密钥，称为公钥和私钥，私钥由密钥所有者保存，不必公开，公钥可以公开。非对称加密算法既可以用于加密也可用于签名。</p>
<p>当用于加密时，消息发送者使用接收者的公钥对消息进行加密，然后将密文传输给接收者，接收者使用对应的私钥对密文进行解密即可得到原始消息。由于经公钥加密的密文只能由对应的私钥进行解密，只要不暴露私钥，就可以安全地传输消息。而非对称加密算法都采用了十分安全的算法保证攻击者难以通过公钥推算私钥，因此可以安全地公开公钥。</p>
<p>当用于签名时，私钥持有者使用自己的私钥对消息的摘要进行签名，然后将消息和摘要的签名一并发送给接收者，接收者可以利用对应的公钥对签名进行解密，并将解密结果与消息摘要进行比对，以确定消息是否被篡改。</p>
<h2 id="二、互质关系"><a href="#二、互质关系" class="headerlink" title="二、互质关系"></a>二、互质关系</h2><p>如果两个正整数，除了1以外，没有其他公因子，我们就称这两个数是互质关系（coprime）。比如，15和32没有公因子，所以它们是互质关系。这说明，不是质数也可以构成互质关系。</p>
<p>关于互质关系，不难得到以下结论：</p>
<blockquote>
<p>　　1. 任意两个质数构成互质关系，比如13和61。</p>
<p>　　2. 一个数是质数，另一个数只要不是前者的倍数，两者就构成互质关系，比如3和10。</p>
<p>　　3. 如果两个数之中，较大的那个数是质数，则两者构成互质关系，比如97和57。</p>
<p>　　4. 1和任意一个自然数是都是互质关系，比如1和99。</p>
<p>　　5. p是大于1的整数，则p和p-1构成互质关系，比如57和56。</p>
<p>　　6. p是大于1的奇数，则p和p-2构成互质关系，比如17和15。</p>
</blockquote>
<p>上述结论中1-4均显而易见，下面对第5点进行证明：</p>
<blockquote>
<p>假设p和p-1存在公因子k，k为正整数，则：<br>(1) p = mk，m为正整数<br>(2) p-1 = nk，n为正整数<br>由(1)(2)可得：(3) (m-n)k = 1<br>由于m，n均为正整数，则m-n也为整数，记为a=m-n<br>则 ak=1，由于a和k均为整数，且k&gt;0，可得a=k=1<br>上述结论说明，p与p-1的公因子k只能为1，即p与p-1互质</p>
</blockquote>
<p>下面对第6点进行证明：</p>
<blockquote>
<p>假设p和p-1存在公因子k，k为正整数，则：<br>(1) p = mk，m为正整数<br>(2) p-2 = nk，n为正整数<br>由(1)(2)可得：(3) (m-n)k = 2<br>由于m，n均为正整数，则m-n也为整数，且k&gt;0<br>则可得两组解：<br>解(1): m-n=1,k=2<br>解(2): m-n=2,k=1<br>由于p为奇数，则因子k不能为偶数，第一组解不成立<br>故只能使用第二组解，可得p和p-2的公因子k为1，p和p-2互质</p>
</blockquote>
<h2 id="不写了"><a href="#不写了" class="headerlink" title="不写了"></a>不写了</h2><p>需要学的东西还很多，有一些阮一峰未介绍的转换细节，参考<a target="_blank" rel="noopener" href="https://cnodejs.org/topic/5bb9c31e15e4fd1923f48d0b">RSA算法的数学原理与证明</a>吧，写不动了，太菜了，总是RSA算法很NB，需要用到大量数论知识</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html">阮一峰：RSA算法原理（一）</a><br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html">阮一峰：RSA算法原理（二）</a><br><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html">阮一峰：数字签名是什么？</a><br><a target="_blank" rel="noopener" href="https://cnodejs.org/topic/5bb9c31e15e4fd1923f48d0b">RSA算法的数学原理与证明</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.lpypl.top/2021/01/16/Nvidia%E5%8F%8C%E6%98%BE%E5%8D%A1%E7%AC%94%E8%AE%B0%E6%9C%AC%E5%8F%8C%E5%B1%8F%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
      <meta itemprop="name" content="Liu Peiyuan">
      <meta itemprop="description" content="刘沛源的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuan's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/16/Nvidia%E5%8F%8C%E6%98%BE%E5%8D%A1%E7%AC%94%E8%AE%B0%E6%9C%AC%E5%8F%8C%E5%B1%8F%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">Nvidia双显卡笔记本双屏配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-16 11:45:00" itemprop="dateCreated datePublished" datetime="2021-01-16T11:45:00+08:00">2021-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-22 00:27:23" itemprop="dateModified" datetime="2025-09-22T00:27:23+08:00">2025-09-22</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2021/01/16/Nvidia%E5%8F%8C%E6%98%BE%E5%8D%A1%E7%AC%94%E8%AE%B0%E6%9C%AC%E5%8F%8C%E5%B1%8F%E9%85%8D%E7%BD%AE/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/01/16/Nvidia双显卡笔记本双屏配置/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>对于Ubuntu 20.10已经可以开箱即用，不过对于Debian10，Arch等系统还是需要专门进行配置才行。  </p>
<h2 id="方案一-使用开源驱动nouveau"><a href="#方案一-使用开源驱动nouveau" class="headerlink" title="方案一 使用开源驱动nouveau"></a>方案一 使用开源驱动nouveau</h2><p>此方案在此时最新的Arch上可行（我的是1050Ti），如果不想折腾直接安装nouveau软件包即可。<br>但是在我的Debian10上并不能直接使用，在此系统上如果没有在内核启动参数添加<code>nouveau.modeset=0</code>的话会直接卡到无法操作，所以PASS。  </p>
<h2 id="方案二-使用Nvidia官方驱动，采用Nvidia单显卡渲染"><a href="#方案二-使用Nvidia官方驱动，采用Nvidia单显卡渲染" class="headerlink" title="方案二 使用Nvidia官方驱动，采用Nvidia单显卡渲染"></a>方案二 使用Nvidia官方驱动，采用Nvidia单显卡渲染</h2><p>步骤如下。</p>
<h3 id="安装nvidia驱动"><a href="#安装nvidia驱动" class="headerlink" title="安装nvidia驱动"></a>安装nvidia驱动</h3><p>这一步根据系统不同安装不同的软件包即可，一般情况下，安装nvidia软件包的时候会自动blasklist nouveau，如果是上古版本可能需要手动blasklist。</p>
<h3 id="xorg-conf配置"><a href="#xorg-conf配置" class="headerlink" title="xorg.conf配置"></a>xorg.conf配置</h3><p>可以在xorg.conf中进行具体配置，也可以在xorg.conf.d中添加一个nvidia配置用于自动配置，第二种方式不需要xorg.conf文件。</p>
<h4 id="方法一-直接配置xorg-conf文件"><a href="#方法一-直接配置xorg-conf文件" class="headerlink" title="方法一 直接配置xorg.conf文件"></a>方法一 直接配置xorg.conf文件</h4><p>为Nvidia显卡配置驱动nvidia，为Intel核显配置驱动modesetting，具体工作原理参见debian和nvidia文档。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Section <span class="string">&quot;ServerLayout&quot;</span></span><br><span class="line">    Identifier     <span class="string">&quot;Layout0&quot;</span></span><br><span class="line">    Screen      0  <span class="string">&quot;nvidia&quot;</span></span><br><span class="line">    Inactive       <span class="string">&quot;intel&quot;</span></span><br><span class="line">EndSection</span><br><span class="line"></span><br><span class="line">Section <span class="string">&quot;Device&quot;</span></span><br><span class="line">    Identifier     <span class="string">&quot;nvidia&quot;</span></span><br><span class="line">    Driver         <span class="string">&quot;nvidia&quot;</span></span><br><span class="line">    <span class="comment"># By default, the NVIDIA X driver will bail out if there </span></span><br><span class="line">    <span class="comment"># are no displays available. In order to ensure that the </span></span><br><span class="line">    <span class="comment"># X server can start with no heads connected directly to </span></span><br><span class="line">    <span class="comment"># the dGPU, you must add </span></span><br><span class="line">    <span class="comment"># &#x27;Option &quot;AllowEmptyInitialConfiguration&quot;&#x27; to the </span></span><br><span class="line">    <span class="comment"># &quot;Screen&quot; section of xorg.conf.</span></span><br><span class="line">    Option         <span class="string">&quot;AllowEmptyInitialConfiguration&quot;</span></span><br><span class="line">    VendorName     <span class="string">&quot;NVIDIA Corporation&quot;</span></span><br><span class="line">EndSection</span><br><span class="line"></span><br><span class="line">Section <span class="string">&quot;Device&quot;</span></span><br><span class="line">    Identifier     <span class="string">&quot;intel&quot;</span></span><br><span class="line">    <span class="comment"># By default, your xorg.conf will be set up such that only</span></span><br><span class="line">    <span class="comment"># the NVIDIA driver will be loaded. In order to ensure </span></span><br><span class="line">    <span class="comment"># that the iGPU’s heads are available for configuration, </span></span><br><span class="line">    <span class="comment"># the &#x27;modesetting&#x27; driver must be specified.</span></span><br><span class="line">    Driver         <span class="string">&quot;modesetting&quot;</span></span><br><span class="line">    VendorName     <span class="string">&quot;Intel Graphics&quot;</span></span><br><span class="line">EndSection</span><br><span class="line"></span><br><span class="line">Section <span class="string">&quot;Screen&quot;</span></span><br><span class="line">    Identifier     <span class="string">&quot;nvidia&quot;</span></span><br><span class="line">    Device         <span class="string">&quot;nvidia&quot;</span></span><br><span class="line">EndSection</span><br><span class="line"></span><br><span class="line">Section <span class="string">&quot;Screen&quot;</span></span><br><span class="line">    Identifier     <span class="string">&quot;intel&quot;</span></span><br><span class="line">    Device         <span class="string">&quot;intel&quot;</span></span><br><span class="line">EndSection</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其实有一个官方工具<code>nvidia-xconfig</code>可以自动生成配置，但是它生成的配置只会在外接显示器上显示，所以需要自己配置双屏，不过可以借助此工具生成一个配置框架再修改。</p>
<h4 id="方法二-添加文件-etc-X11-xorg-conf-d-10-nvidia-drm-outputclass-conf指导系统进行自动配置"><a href="#方法二-添加文件-etc-X11-xorg-conf-d-10-nvidia-drm-outputclass-conf指导系统进行自动配置" class="headerlink" title="方法二 添加文件/etc/X11/xorg.conf.d/10-nvidia-drm-outputclass.conf指导系统进行自动配置"></a>方法二 添加文件<code>/etc/X11/xorg.conf.d/10-nvidia-drm-outputclass.conf</code>指导系统进行自动配置</h4><p>这个方法来自<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/NVIDIA_Optimus#Use_NVIDIA_graphics_only">Arch的文档</a>，和方法一的核心配置大致相同，只是方法一是直接指定了Device，Screen，ServerLayout等，这里只是添加OutputClass，指导X Server自动配置。</p>
<p>添加文件<code>/etc/X11/xorg.conf.d/10-nvidia-drm-outputclass.conf</code>，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Section &quot;OutputClass&quot;</span><br><span class="line">	Identifier  &quot;intel&quot;</span><br><span class="line">	MatchDriver &quot;i915&quot;</span><br><span class="line">	Driver      &quot;modesetting&quot;</span><br><span class="line">EndSection</span><br><span class="line"></span><br><span class="line">Section &quot;OutputClass&quot;</span><br><span class="line">	Identifier  &quot;nvidia&quot;</span><br><span class="line">	MatchDriver &quot;nvidia-drm&quot;</span><br><span class="line">	Driver      &quot;nvidia&quot;</span><br><span class="line">	Option      &quot;AllowEmptyInitialConfiguration&quot;</span><br><span class="line">	Option      &quot;PrimaryGPU&quot;   &quot;yes&quot;</span><br><span class="line">	ModulePath  &quot;/usr/lib/nvidia/xorg&quot;</span><br><span class="line">	ModulePath  &quot;/usr/lib/xorg/modules&quot;</span><br><span class="line">EndSection</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="使用xrandr配置双屏"><a href="#使用xrandr配置双屏" class="headerlink" title="使用xrandr配置双屏"></a>使用<code>xrandr</code>配置双屏</h3><p>配置完上面的之后可能需要重启X服务，最简单的方法大概就是直接重启机器了。  </p>
<p>配置内容如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xrandr --setprovideroutputsource modesetting NVIDIA-0</span><br><span class="line">xrandr --auto</span><br><span class="line"><span class="comment"># 如果显示DPI不正常的话添加下面的DPI配置</span></span><br><span class="line"><span class="comment"># xrandr --dpi 96</span></span><br></pre></td></tr></table></figure>
<p>其中最关键的是第一条命令。可以把这几条命令写入 <code>~/.xinitrc</code> 或者 <code>~/xsession</code>，根据自己的具体情况吧，也可能需要配置你的Display Manager（如果有的话）。</p>
<p>核心步骤已经说的差不多了，到这里为止应该已经可以在xrandr中看到内置显示器和外置显示器都处于connected状态了，已经可以根据自己的需要进行输出了。</p>
<p>顺便附上自己的 <code>.xinitrc</code>，这来自一台没有使用Display Manager的Arch系统，在 <code>.xinitrc</code> 的最后启动了i3桌面管理器。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment">#            original /etc/X11/xinit/xinitrc          #</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"></span><br><span class="line">userresources=<span class="variable">$HOME</span>/.Xresources</span><br><span class="line">usermodmap=<span class="variable">$HOME</span>/.Xmodmap</span><br><span class="line">sysresources=/etc/X11/xinit/.Xresources</span><br><span class="line">sysmodmap=/etc/X11/xinit/.Xmodmap</span><br><span class="line"></span><br><span class="line"><span class="comment"># merge in defaults and keymaps</span></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$sysresources</span> ]; <span class="keyword">then</span></span><br><span class="line">    xrdb -merge <span class="variable">$sysresources</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$sysmodmap</span> ]; <span class="keyword">then</span></span><br><span class="line">    xmodmap <span class="variable">$sysmodmap</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$userresources</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    xrdb -merge <span class="string">&quot;<span class="variable">$userresources</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$usermodmap</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    xmodmap <span class="string">&quot;<span class="variable">$usermodmap</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># start some nice programs</span></span><br><span class="line"><span class="keyword">if</span> [ -d /etc/X11/xinit/xinitrc.d ] ; <span class="keyword">then</span></span><br><span class="line"> <span class="keyword">for</span> f <span class="keyword">in</span> /etc/X11/xinit/xinitrc.d/?*.sh ; <span class="keyword">do</span></span><br><span class="line">  [ -x <span class="string">&quot;<span class="variable">$f</span>&quot;</span> ] &amp;&amp; . <span class="string">&quot;<span class="variable">$f</span>&quot;</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"> <span class="built_in">unset</span> f</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment">#                     lpy&#x27;s xinitrc                   #</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Dual Display</span></span><br><span class="line"><span class="comment"># The X server must be told to configure iGPU displays using PRIME. </span></span><br><span class="line"><span class="comment"># This can be done using the ‘xrandr’ command line tool, </span></span><br><span class="line"><span class="comment"># via ‘xrandr –setprovideroutputsource modesetting NVIDIA-0’. </span></span><br><span class="line"><span class="comment"># If this fails, you can verify the available graphics devices </span></span><br><span class="line"><span class="comment"># using ‘xrandr –listproviders’.</span></span><br><span class="line">xrandr --setprovideroutputsource modesetting NVIDIA-0</span><br><span class="line"><span class="comment"># Once PRIME is configured as described above, the iGPU’s heads may </span></span><br><span class="line"><span class="comment"># be configured as if they were the dGPU’s with any RandR-aware tool, </span></span><br><span class="line"><span class="comment"># be it ‘xrandr’ or a distro-provided graphical tool. The easiest way </span></span><br><span class="line"><span class="comment"># to get something to display is ‘xrandr –auto’, but more complicated </span></span><br><span class="line"><span class="comment"># configuration is possible as well.</span></span><br><span class="line">xrandr --auto</span><br><span class="line"><span class="comment"># If your display dpi is not correct add the following line</span></span><br><span class="line"><span class="comment"># xrandr --dpi 96</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable DPMS turning off the screen</span></span><br><span class="line">xset -dpms</span><br><span class="line">xset s off</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable bell</span></span><br><span class="line">xset -b</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable zapping (C-A-&lt;Bksp&gt; kills X)</span></span><br><span class="line">setxkbmap -option terminate:ctrl_alt_bksp</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enforce correct locales from the beginning:</span></span><br><span class="line"><span class="comment"># LC_ALL is unset since it overwrites everything</span></span><br><span class="line"><span class="comment"># LANG=de_DE.UTF-8 is used, except for:</span></span><br><span class="line"><span class="comment"># LC_MESSAGES=C never translates program output</span></span><br><span class="line"><span class="comment"># LC_TIME=en_DK leads to yyyy-mm-dd hh:mm date/time output</span></span><br><span class="line"><span class="built_in">unset</span> LC_ALL</span><br><span class="line"><span class="built_in">export</span> LANG=zh_CN.UTF-8</span><br><span class="line"><span class="built_in">export</span> LC_MESSAGES=C</span><br><span class="line"><span class="built_in">export</span> LC_TIME=en_US.UTF-8</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use XToolkit in java applications</span></span><br><span class="line"><span class="built_in">export</span> AWT_TOOLKIT=XToolkit</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set background color</span></span><br><span class="line">xsetroot -solid <span class="string">&quot;#333333&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable core dumps in case something goes wrong</span></span><br><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br><span class="line"></span><br><span class="line"><span class="comment"># input method</span></span><br><span class="line"><span class="built_in">export</span> GTK_IM_MODULE=ibus</span><br><span class="line"><span class="built_in">export</span> QT_IM_MODULE=ibus</span><br><span class="line"><span class="built_in">export</span> XMODIFIERS=@im=ibus</span><br><span class="line"></span><br><span class="line"><span class="comment"># i3-sensible-terminal</span></span><br><span class="line"><span class="built_in">export</span> TERMINAL=termite</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start i3 and log to ~/.i3/logfile</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/.i3/log</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Starting at <span class="subst">$(date)</span>&quot;</span> &gt;&gt; ~/.i3/log/<span class="string">&quot;<span class="subst">$(date +%Y%m%d)</span>&quot;</span>.<span class="built_in">log</span></span><br><span class="line"><span class="built_in">exec</span> /usr/bin/i3 -V -d all &gt;&gt; ~/.i3/log/<span class="string">&quot;<span class="subst">$(date +%Y%m%d)</span>&quot;</span>.<span class="built_in">log</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://wiki.debian.org/NVIDIA%20Optimus">Debian Wiki - NVIDIA Optimus</a><br><a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/prime-and-prime-synchronization/44423">Nvidia Forums - Prime and Prime synchronization</a><br><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/NVIDIA_Optimus#Use_NVIDIA_graphics_only">Arch Wiki - NVIDIA Optimus</a>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Liu Peiyuan"
      src="https://cdn.jsdelivr.net/gh/lpypl/picgo-repo/data/1639911209663.jpg">
  <p class="site-author-name" itemprop="name">Liu Peiyuan</p>
  <div class="site-description" itemprop="description">刘沛源的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/lpypl" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lpypl" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:lpy.henu@gmail.com" title="E-Mail → mailto:lpy.henu@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/lpypl" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;lpypl" rel="noopener" target="_blank"><i class="fab fa-telegram fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Peiyuan</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">67k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">2:02</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://lpypl.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
